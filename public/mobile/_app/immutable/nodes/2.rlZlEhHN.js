import{a as S,f as N,t as Na,c as Ia}from"../chunks/BeLDpIZU.js";import{i as yt}from"../chunks/BVGeze1C.js";import{o as wt}from"../chunks/CjQRpxdN.js";import{h as ke,d as ia,U as St,m as ca,a as xt,b as Ct,B as e,r as Et,c as kt,s as Oa,e as ua,o as ra,S as Tt,av as Pt,af as La,j as Ge,n as ga,ax as Dt,u as At,ay as Va,az as Mt,at as _a,aA as Nt,a3 as Ra,aB as It,aC as Ot,aD as y,aE as Ne,k as $a,p as ja,aF as va,aG as Lt,as as Rt,l as qt,T as Ht,aH as Ja,q as Ut,aI as Ft,aJ as Vt,aK as $t,y as _,a1 as jt,aL as Jt,I as Bt,aM as Ze,aN as zt,J as da,M as Kt,aO as r,Q as n,O as l,P as s,K,ag as Yt,aP as qa,C as Qt}from"../chunks/CCn5lCzK.js";import{s as m,e as R}from"../chunks/CwVei1Xu.js";import{i as fe}from"../chunks/BJ1Kd9qA.js";import{r as Be,s as Ha,a as Gt}from"../chunks/C5tQPx1-.js";function Ye(a,u){return u}function Wt(a,u,v){for(var c=[],p=u.length,d,h=u.length,x=0;x<p;x++){let ne=u[x];ja(ne,()=>{if(d){if(d.pending.delete(ne),d.done.add(ne),d.pending.size===0){var U=a.outrogroups;pa(_a(d.done)),U.delete(d),U.size===0&&(a.outrogroups=null)}}else h-=1},!1)}if(h===0){var f=c.length===0&&v!==null;if(f){var C=v,b=C.parentNode;Rt(b),b.append(C),a.items.clear()}pa(u,!f)}else d={pending:new Set(u),done:new Set},(a.outrogroups??=new Set).add(d)}function pa(a,u=!0){for(var v=0;v<a.length;v++)qt(a[v],u)}var Ua;function Qe(a,u,v,c,p,d=null){var h=a,x=new Map,f=(u&Ja)!==0;if(f){var C=a;h=ke?ia(St(C)):C.appendChild(ca())}ke&&xt();var b=null,ne=Va(()=>{var g=v();return Mt(g)?g:g==null?[]:_a(g)}),U,j=!0;function Y(){i.fallback=b,Xt(i,U,h,u,c),b!==null&&(U.length===0?(b.f&Ne)===0?$a(b):(b.f^=Ne,aa(b,null,h)):ja(b,()=>{b=null}))}var oe=Ct(()=>{U=e(ne);var g=U.length;let Se=!1;if(ke){var Te=Et(h)===kt;Te!==(g===0)&&(h=Oa(),ia(h),ua(!1),Se=!0)}for(var ie=new Set,xe=Ge,q=At(),I=0;I<g;I+=1){ke&&ra.nodeType===Tt&&ra.data===Pt&&(h=ra,Se=!0,ua(!1));var Z=U[I],F=c(Z,I),V=j?null:x.get(F);V?(V.v&&La(V.v,Z),V.i&&La(V.i,I),q&&xe.unskip_effect(V.e)):(V=Zt(x,j?h:Ua??=ca(),Z,F,I,p,u,v),j||(V.e.f|=Ne),x.set(F,V)),ie.add(F)}if(g===0&&d&&!b&&(j?b=ga(()=>d(h)):(b=ga(()=>d(Ua??=ca())),b.f|=Ne)),g>ie.size&&Dt(),ke&&g>0&&ia(Oa()),!j)if(q){for(const[Me,me]of x)ie.has(Me)||xe.skip_effect(me.e);xe.oncommit(Y),xe.ondiscard(()=>{})}else Y();Se&&ua(!0),e(ne)}),i={effect:oe,items:x,outrogroups:null,fallback:b};j=!1,ke&&(h=ra)}function ea(a){for(;a!==null&&(a.f&Lt)===0;)a=a.next;return a}function Xt(a,u,v,c,p){var d=(c&Ft)!==0,h=u.length,x=a.items,f=ea(a.effect.first),C,b=null,ne,U=[],j=[],Y,oe,i,g;if(d)for(g=0;g<h;g+=1)Y=u[g],oe=p(Y,g),i=x.get(oe).e,(i.f&Ne)===0&&(i.nodes?.a?.measure(),(ne??=new Set).add(i));for(g=0;g<h;g+=1){if(Y=u[g],oe=p(Y,g),i=x.get(oe).e,a.outrogroups!==null)for(const V of a.outrogroups)V.pending.delete(i),V.done.delete(i);if((i.f&Ne)!==0)if(i.f^=Ne,i===f)aa(i,null,v);else{var Se=b?b.next:f;i===a.effect.last&&(a.effect.last=i.prev),i.prev&&(i.prev.next=i.next),i.next&&(i.next.prev=i.prev),Re(a,b,i),Re(a,i,Se),aa(i,Se,v),b=i,U=[],j=[],f=ea(b.next);continue}if((i.f&va)!==0&&($a(i),d&&(i.nodes?.a?.unfix(),(ne??=new Set).delete(i))),i!==f){if(C!==void 0&&C.has(i)){if(U.length<j.length){var Te=j[0],ie;b=Te.prev;var xe=U[0],q=U[U.length-1];for(ie=0;ie<U.length;ie+=1)aa(U[ie],Te,v);for(ie=0;ie<j.length;ie+=1)C.delete(j[ie]);Re(a,xe.prev,q.next),Re(a,b,xe),Re(a,q,Te),f=Te,b=q,g-=1,U=[],j=[]}else C.delete(i),aa(i,f,v),Re(a,i.prev,i.next),Re(a,i,b===null?a.effect.first:b.next),Re(a,b,i),b=i;continue}for(U=[],j=[];f!==null&&f!==i;)(C??=new Set).add(f),j.push(f),f=ea(f.next);if(f===null)continue}(i.f&Ne)===0&&U.push(i),b=i,f=ea(i.next)}if(a.outrogroups!==null){for(const V of a.outrogroups)V.pending.size===0&&(pa(_a(V.done)),a.outrogroups?.delete(V));a.outrogroups.size===0&&(a.outrogroups=null)}if(f!==null||C!==void 0){var I=[];if(C!==void 0)for(i of C)(i.f&va)===0&&I.push(i);for(;f!==null;)(f.f&va)===0&&f!==a.fallback&&I.push(f),f=ea(f.next);var Z=I.length;if(Z>0){var F=(c&Ja)!==0&&h===0?v:null;if(d){for(g=0;g<Z;g+=1)I[g].nodes?.a?.measure();for(g=0;g<Z;g+=1)I[g].nodes?.a?.fix()}Wt(a,I,F)}}d&&Ut(()=>{if(ne!==void 0)for(i of ne)i.nodes?.a?.apply()})}function Zt(a,u,v,c,p,d,h,x){var f=(h&It)!==0?(h&Ot)===0?y(v,!1,!1):Ra(v):null,C=(h&Nt)!==0?Ra(p):null;return{v:f,i:C,e:ga(()=>(d(u,f??v,C??p,x),()=>{a.delete(c)}))}}function aa(a,u,v){if(a.nodes)for(var c=a.nodes.start,p=a.nodes.end,d=u&&(u.f&Ne)===0?u.nodes.start:v;c!==null;){var h=Ht(c);if(d.before(c),c===p)return;c=h}}function Re(a,u,v){u===null?a.effect.first=v:u.next=v,v===null?a.effect.last=u:v.prev=u}const Fa=[...` 	
\r\f¬†\v\uFEFF`];function er(a,u,v){var c=a==null?"":""+a;if(u&&(c=c?c+" "+u:u),v){for(var p in v)if(v[p])c=c?c+" "+p:p;else if(c.length)for(var d=p.length,h=0;(h=c.indexOf(p,h))>=0;){var x=h+d;(h===0||Fa.includes(c[h-1]))&&(x===c.length||Fa.includes(c[x]))?c=(h===0?"":c.substring(0,h))+c.substring(x+1):h=x}}return c===""?null:c}function ar(a,u){return a==null?null:String(a)}function qe(a,u,v,c,p,d){var h=a.__className;if(ke||h!==v||h===void 0){var x=er(v,c,d);(!ke||x!==a.getAttribute("class"))&&(x==null?a.removeAttribute("class"):a.className=x),a.__className=v}else if(d&&p!==d)for(var f in d){var C=!!d[f];(p==null||C!==!!p[f])&&a.classList.toggle(f,C)}return d}function tr(a,u,v,c){var p=a.__style;if(ke||p!==u){var d=ar(u);(!ke||d!==a.getAttribute("style"))&&(d==null?a.removeAttribute("style"):a.style.cssText=d),a.__style=u}return c}function He(a,u,v=u){var c=new WeakSet;Vt(a,"input",async p=>{var d=p?a.defaultValue:a.value;if(d=ha(a)?fa(d):d,v(d),Ge!==null&&c.add(Ge),await $t(),d!==(d=u())){var h=a.selectionStart,x=a.selectionEnd,f=a.value.length;if(a.value=d??"",x!==null){var C=a.value.length;h===x&&x===f&&C>f?(a.selectionStart=C,a.selectionEnd=C):(a.selectionStart=h,a.selectionEnd=Math.min(x,C))}}}),(ke&&a.defaultValue!==a.value||_(u)==null&&a.value)&&(v(ha(a)?fa(a.value):a.value),Ge!==null&&c.add(Ge)),jt(()=>{var p=u();if(a===document.activeElement){var d=Jt??Ge;if(c.has(d))return}ha(a)&&p===fa(a.value)||a.type==="date"&&!p&&!a.value||p!==a.value&&(a.value=p??"")})}function ha(a){var u=a.type;return u==="number"||u==="range"}function fa(a){return a===""?null:+a}function rr(a){return function(...u){var v=u[0];return v.preventDefault(),a?.apply(this,u)}}const sr="/api/v1/retreat";function lr(a,u){if(!a)return`Request failed (${u})`;try{const v=JSON.parse(a);if(v.error)return v.error;if(v.message)return v.message;if(v.errors&&typeof v.errors=="object"){const c=Object.values(v.errors)[0];if(Array.isArray(c)&&c.length>0)return String(c[0]);if(typeof c=="string")return c}}catch{}return a}async function _e(a,u={},v){const c=new Headers(u.headers??{});c.set("Accept","application/json"),u.body&&!c.has("Content-Type")&&c.set("Content-Type","application/json"),v&&c.set("X-Device-Token",v);const p=await fetch(`${sr}${a}`,{...u,headers:c});if(!p.ok){const d=await p.text();throw new Error(lr(d,p.status))}return await p.json()}var nr=N('<main class="boot-screen svelte-1uha8ag"><h1>Loading Calvary Caravan‚Ä¶</h1> <p>Syncing your convoy workspace.</p></main>'),or=N('<main class="join-shell svelte-1uha8ag"><section class="join-card svelte-1uha8ag"><div class="join-header svelte-1uha8ag"><span class="eyebrow svelte-1uha8ag">Calvary Caravan</span> <h1 class="svelte-1uha8ag">Join the Retreat</h1> <p class="svelte-1uha8ag">Enter your retreat code and basic details to sync with your group on the road.</p></div> <form class="join-form svelte-1uha8ag"><label class="svelte-1uha8ag">6-character invite code <input maxlength="6" placeholder="TEST26" required="" class="svelte-1uha8ag"/></label> <label class="svelte-1uha8ag">Full name <input maxlength="50" placeholder="e.g. Sarah Jenkins" required="" class="svelte-1uha8ag"/></label> <div class="split-fields svelte-1uha8ag"><label class="svelte-1uha8ag">Vehicle color <input maxlength="30" placeholder="e.g. Silver" class="svelte-1uha8ag"/></label> <label class="svelte-1uha8ag">Make/model <input maxlength="50" placeholder="e.g. Honda CR-V" class="svelte-1uha8ag"/></label></div> <button type="submit" class="svelte-1uha8ag"> </button></form> <div class="join-footer"><button type="button" class="theme-toggle svelte-1uha8ag"> </button></div></section></main>'),ir=N('<section class="status-banner card svelte-1uha8ag"><div><strong> </strong> <p class="svelte-1uha8ag"><!></p></div> <button type="button" class="small svelte-1uha8ag">Retry now</button></section>'),cr=N('<button type="button"><span> </span> <small class="svelte-1uha8ag"> </small></button>'),ur=N('<div class="map-empty svelte-1uha8ag"><strong>No live markers yet</strong> <p class="svelte-1uha8ag">As participants share location, they will appear here.</p></div>'),vr=N('<button type="button"><span> </span> <small class="svelte-1uha8ag"> </small></button>'),dr=N('<button type="button" class="pill svelte-1uha8ag"><span> </span> <span> </span> <small class="svelte-1uha8ag"> </small></button>'),hr=N('<section class="map-panel card svelte-1uha8ag"><div class="panel-head svelte-1uha8ag"><h3 class="svelte-1uha8ag">Live Convoy Map</h3> <p class="svelte-1uha8ag"> </p></div> <div class="map-canvas svelte-1uha8ag"><div class="map-grid svelte-1uha8ag"></div> <div class="map-road svelte-1uha8ag"></div> <!></div> <div class="participant-row svelte-1uha8ag"></div></section>'),fr=N('<div class="empty-state svelte-1uha8ag"><strong>No waypoints loaded</strong> <p class="svelte-1uha8ag">Waypoints from the retreat route will show here automatically.</p></div>'),gr=N('<article class="timeline-card svelte-1uha8ag"><div></div> <div><p class="eyebrow svelte-1uha8ag"></p> <h4 class="svelte-1uha8ag"> </h4> <p class="svelte-1uha8ag"> </p> <small class="svelte-1uha8ag"> </small></div></article>'),pr=N('<div class="timeline svelte-1uha8ag"></div>'),_r=N('<section class="panel card svelte-1uha8ag"><div class="panel-head svelte-1uha8ag"><h3 class="svelte-1uha8ag">Waypoints & Schedule</h3> <p class="svelte-1uha8ag">Keep everyone aligned on ETAs and checkpoint progress.</p></div> <!></section>'),mr=N('<div class="empty-state svelte-1uha8ag"><strong>No messages yet</strong> <p class="svelte-1uha8ag">Start with a quick check-in for the group.</p></div>'),br=N('<article><header class="svelte-1uha8ag"><strong> </strong> <small class="svelte-1uha8ag"> </small></header> <p class="svelte-1uha8ag"> </p></article>'),yr=N('<small class="subtle svelte-1uha8ag"> </small>'),wr=N('<section class="panel card svelte-1uha8ag"><div class="panel-head svelte-1uha8ag"><h3 class="svelte-1uha8ag">Group Chat</h3> <p class="svelte-1uha8ag">Use chat for normal updates and prayer mode for care moments.</p></div> <div class="chat-list svelte-1uha8ag"><!></div> <div class="composer svelte-1uha8ag"><div class="mode-toggle svelte-1uha8ag"><button type="button">Chat</button> <button type="button">Prayer Request</button></div> <textarea rows="3" class="svelte-1uha8ag"></textarea> <button type="button" class="svelte-1uha8ag">Send</button> <!></div></section>'),Sr=N('<div class="empty-state svelte-1uha8ag"><strong>Leader access required</strong> <p class="svelte-1uha8ag">You can receive alerts here, but only leaders can broadcast emergency notices.</p></div>'),xr=N('<button type="button"> </button>'),Cr=N('<div class="alert-builder svelte-1uha8ag"><div class="severity-grid svelte-1uha8ag"></div> <textarea rows="4" placeholder="Describe the urgent issue and what the group should do next." class="svelte-1uha8ag"></textarea> <div class="alert-preview card svelte-1uha8ag"><p class="eyebrow svelte-1uha8ag">Preview</p> <p class="svelte-1uha8ag"><strong> </strong> </p></div> <button type="button" class="danger svelte-1uha8ag">Send emergency alert</button></div>'),Er=N('<section class="panel card svelte-1uha8ag"><div class="panel-head svelte-1uha8ag"><h3 class="svelte-1uha8ag">Emergency Alert Composer</h3> <p class="svelte-1uha8ag">Leader-only high-signal channel with confirmation safeguard.</p></div> <!></section>'),kr=N('<img alt="Profile" class="svelte-1uha8ag"/>'),Tr=N('<div class="avatar-fallback svelte-1uha8ag"> </div>'),Pr=N('<section class="panel card svelte-1uha8ag"><div class="panel-head svelte-1uha8ag"><h3 class="svelte-1uha8ag">Profile & Vehicle</h3> <p class="svelte-1uha8ag">Keep your details current so others can identify you quickly on the road.</p></div> <article class="profile-card card svelte-1uha8ag"><div class="avatar-wrap svelte-1uha8ag"><!></div> <div class="profile-fields svelte-1uha8ag"><label class="svelte-1uha8ag">Name <input readonly="" class="svelte-1uha8ag"/></label> <label class="svelte-1uha8ag">Vehicle color <input placeholder="e.g. Silver" class="svelte-1uha8ag"/></label> <label class="svelte-1uha8ag">Make/model <input placeholder="e.g. Honda CR-V" class="svelte-1uha8ag"/></label></div></article> <div class="profile-actions svelte-1uha8ag"><label class="upload-btn svelte-1uha8ag"> <input type="file" accept="image/png,image/jpeg,image/webp" class="svelte-1uha8ag"/></label> <button type="button" class="ghost svelte-1uha8ag">Remove photo</button> <button type="button" class="ghost svelte-1uha8ag">Save vehicle details</button> <button type="button" class="danger-outline svelte-1uha8ag"> </button></div></section>'),Dr=N('<main><header class="topbar card svelte-1uha8ag"><div><p class="eyebrow svelte-1uha8ag"> </p> <h2 class="svelte-1uha8ag">Convoy Control</h2> <p class="subtle svelte-1uha8ag"> </p></div> <div class="topbar-actions svelte-1uha8ag"><button type="button" class="ghost svelte-1uha8ag"> </button> <button type="button" class="ghost svelte-1uha8ag"> </button></div></header> <!> <nav class="tabbar card svelte-1uha8ag"></nav> <!></main>'),Ar=N('<section class="sheet-backdrop svelte-1uha8ag" aria-label="Participant quick actions"><button type="button" class="sheet-hitbox svelte-1uha8ag" aria-label="Close participant quick actions"></button> <article class="participant-sheet card svelte-1uha8ag"><header class="svelte-1uha8ag"><h4 class="svelte-1uha8ag"> </h4> <p class="svelte-1uha8ag"> </p></header> <div class="quick-actions svelte-1uha8ag"><button type="button" class="svelte-1uha8ag">üìû Call</button> <button type="button" class="svelte-1uha8ag">üí¨ Message</button> <button type="button" class="svelte-1uha8ag">üôè Pray</button> <button type="button" class="alert-leader-btn svelte-1uha8ag"><span class="alert-leader-icon svelte-1uha8ag" aria-hidden="true">üö®</span> <span>Alert leader</span></button></div> <small class="subtle svelte-1uha8ag"> </small></article></section>'),Mr=N(`<section class="sheet-backdrop svelte-1uha8ag" aria-label="Emergency confirmation"><button type="button" class="sheet-hitbox svelte-1uha8ag" aria-label="Close emergency confirmation"></button> <article class="confirm-modal card svelte-1uha8ag"><h4 class="svelte-1uha8ag">Confirm emergency broadcast</h4> <p class="svelte-1uha8ag">This sends a <strong> </strong> alert to the full retreat group.
        Please confirm this message is accurate.</p> <blockquote class="svelte-1uha8ag"> </blockquote> <div class="confirm-actions svelte-1uha8ag"><button type="button" class="ghost svelte-1uha8ag">Cancel</button> <button type="button" class="danger svelte-1uha8ag">Send now</button></div></article></section>`),Nr=N('<aside class="toast error svelte-1uha8ag"> </aside>'),Ir=N('<aside class="toast success svelte-1uha8ag"> </aside>'),Or=N("<!> <!> <!> <!> <!>",1);function $r(a,u){Bt(u,!1);const v=y(),c=y(),p=y(),d=y(),h="caravan_device_token",x="caravan_theme_mode";let f=y(!1),C=y(!1),b=y(!1),ne=y(!1),U=y(!1),j=y(!1),Y=y("map"),oe=y("chat"),i=y("day"),g=y(!0),Se=y(""),Te=y(""),ie=y(""),xe=y(""),q="",I=y(null),Z=y(null),F=y([]),V=y([]),Me=y([]),me=y([]),Ue=y(""),Fe=y(""),Ce=y("high"),We=y(!1),ee=y(null),Ve=y(""),$e=y(""),ze=y(""),Xe=y(""),Ie=y(""),sa=null;const Ba=[{id:"map",label:"Map",icon:"üó∫Ô∏è"},{id:"waypoints",label:"Plan",icon:"üìç"},{id:"chat",label:"Chat",icon:"üí¨"},{id:"alert",label:"Alert",icon:"üö®"},{id:"profile",label:"Profile",icon:"üë§"}];function ma(t){return t.trim().toUpperCase().replace(/[^A-Z0-9]/g,"").slice(0,6)}function ba(t){if(!t)return"TBD";const o=new Date(t);return Number.isNaN(o.getTime())?"TBD":o.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"})}function ya(t){return t==null?"offline":t<60?"just now":t<3600?`${Math.floor(t/60)}m ago`:`${Math.floor(t/3600)}h ago`}function za(t,o){if(!t.location||e(c).length===0)return{x:18+o%4*22,y:25+Math.floor(o/4)*22};const P=e(c).map(ge=>ge.location.lat),w=e(c).map(ge=>ge.location.lng),E=Math.min(...P),O=Math.max(...P),se=Math.min(...w),ve=Math.max(...w),be=Math.max(O-E,.003),le=Math.max(ve-se,.003),ye=(t.location.lng-se)/le,he=(t.location.lat-E)/be;return{x:10+ye*80,y:82-he*66}}function Oe(t){r(Xe,t),setTimeout(()=>{e(Xe)===t&&r(Xe,"")},2600)}function Pe(t){r(ze,t),setTimeout(()=>{e(ze)===t&&r(ze,"")},4200)}async function Ka(){r(b,!0),r(ze,"");try{q=(await _e("/join",{method:"POST",body:JSON.stringify({code:ma(e(Se)),name:e(Te).trim(),vehicle_color:e(ie).trim()||null,vehicle_description:e(xe).trim()||null})})).data.device_token,localStorage.setItem(h,q),await wa(q),Oe("Joined convoy successfully.")}catch(t){Pe(t instanceof Error?t.message:"Unable to join retreat.")}finally{r(b,!1)}}async function wa(t){{const[o,P,w,E]=await Promise.all([_e("/status",{},t),_e("/locations",{},t),_e("/waypoints",{},t),_e("/messages?limit=100",{},t)]);r(I,o.data.participant),r(Z,o.data.retreat),r(F,P.data),r(V,[...w.data].sort((se,ve)=>se.order-ve.order)),r(Me,E.data);const O=e(F).find(se=>se.is_current_user);O&&(r(Ve,O.vehicle_color??e(Ve)),r($e,O.vehicle_description??e($e))),r(C,!0),r(f,!0)}}async function je(){if(!(!q||!e(C))){r(ne,!0);try{const[t,o,P]=await Promise.all([_e("/locations",{},q),_e("/waypoints",{},q),_e("/messages?limit=100",{},q)]);r(F,t.data),r(V,[...o.data].sort((E,O)=>E.order-O.order)),r(Me,P.data);const w=e(F).find(E=>E.is_current_user);w&&(r(Ve,w.vehicle_color??e(Ve)),r($e,w.vehicle_description??e($e)))}catch(t){Pe(t instanceof Error?t.message:"Unable to refresh retreat data.")}finally{r(ne,!1)}}}function Sa(t,o){r(me,[...e(me),{id:`${Date.now()}-${Math.random().toString(16).slice(2,8)}`,content:t,mode:o,createdAt:Date.now()}]),r(Ie,`${e(me).length} message${e(me).length===1?"":"s"} queued while offline.`)}async function Ya(){const t=e(Ue).trim();if(t){if(!e(g)){Sa(t,e(oe)),r(Ue,"");return}await xa(t,e(oe)),r(Ue,"")}}async function xa(t,o){const P=e(F).find(E=>E.is_current_user),w={content:o==="prayer"?`üôè Prayer Request: ${t}`:t,message_type:"chat",latitude:P?.location?.lat,longitude:P?.location?.lng};try{await _e("/messages",{method:"POST",body:JSON.stringify(w)},q),await je(),Oe(o==="prayer"?"Prayer request sent.":"Message sent.")}catch(E){const O=E instanceof Error?E.message:"Unable to send message.";Pe(O),Sa(t,o)}}async function Ca(){if(!e(me).length||!e(g))return;const t=[...e(me)];r(me,[]);for(const o of t)await xa(o.content,o.mode);r(Ie,"Queued messages flushed."),setTimeout(()=>{e(Ie)==="Queued messages flushed."&&r(Ie,"")},2500)}async function Qa(){if(!e(p)){Pe("Only retreat leaders can send emergency alerts.");return}const t=e(Fe).trim();if(!t){Pe("Please enter the emergency message before sending.");return}try{await _e("/messages",{method:"POST",body:JSON.stringify({message_type:"alert",content:`[${e(Ce).toUpperCase()}] ${t}`})},q),Oe(`Emergency alert sent (${e(Ce)}).`),r(Fe,""),r(We,!1),r(Y,"chat"),await je()}catch(o){Pe(o instanceof Error?o.message:"Unable to send emergency alert.")}}function Ea(t){r(ee,t)}function Ga(){r(ee,null)}function Wa(t){r(Y,"chat"),r(oe,"chat"),r(Ue,`@${t.name} `),r(ee,null)}function Xa(t){r(Y,"chat"),r(oe,"prayer"),r(Ue,`Praying for ${t.name} ‚Äî `),r(ee,null)}function Za(t){r(Y,"alert"),r(Ce,"high"),r(Fe,`Need leader support near ${t.name}: `),r(ee,null)}function et(t){Oe("Call shortcut wired. Number binding comes next.")}async function at(t){if(t&&q){r(j,!0);try{const o=await lt(t);await _e("/profile-photo",{method:"POST",body:JSON.stringify({avatar_base64:o})},q),Oe("Profile photo updated."),await je()}catch(o){Pe(o instanceof Error?o.message:"Could not upload profile photo.")}finally{r(j,!1)}}}async function tt(){if(q){r(j,!0);try{await _e("/profile-photo",{method:"DELETE"},q),Oe("Profile photo removed."),await je()}catch(t){Pe(t instanceof Error?t.message:"Could not remove profile photo.")}finally{r(j,!1)}}}async function rt(){if(q){r(U,!0);try{await _e("/leave",{method:"POST"},q),localStorage.removeItem(h),r(C,!1),q="",r(I,null),r(Z,null),r(F,[]),r(V,[]),r(Me,[]),r(me,[]),Oe("You have left the retreat.")}catch(t){Pe(t instanceof Error?t.message:"Could not leave retreat.")}finally{r(U,!1)}}}async function st(){if(!e(g)){Pe("Still offline. Messages remain queued.");return}await Ca()}function lt(t){return new Promise((o,P)=>{const w=new FileReader;w.onload=()=>o(String(w.result)),w.onerror=()=>P(new Error("Failed to read file")),w.readAsDataURL(t)})}function nt(){const t=new Date().toISOString(),o=Date.now();r(I,{id:101,name:"Chris Hogg",is_leader:!0,avatar_url:null}),r(Z,{id:501,name:"Spring Retreat Convoy",destination:{name:"Branson Camp Grounds",lat:36.6406,lng:-93.2185},starts_at:new Date(o-3600*1e3).toISOString(),ends_at:new Date(o+1080*60*1e3).toISOString(),participant_count:4}),r(F,[{participant_id:101,name:"Chris Hogg",gender:null,avatar_url:null,vehicle_color:"Silver",vehicle_description:"Ford F-150",is_leader:!0,is_current_user:!0,location:{lat:36.612,lng:-93.287,accuracy:9,speed:17,heading:112,recorded_at:t},last_seen_seconds_ago:5},{participant_id:102,name:"Sarah Jenkins",gender:null,avatar_url:null,vehicle_color:"White",vehicle_description:"Honda CR-V",is_leader:!1,is_current_user:!1,location:{lat:36.618,lng:-93.272,accuracy:13,speed:18,heading:108,recorded_at:t},last_seen_seconds_ago:28},{participant_id:103,name:"Micah Davis",gender:null,avatar_url:null,vehicle_color:"Blue",vehicle_description:"Chevy Traverse",is_leader:!1,is_current_user:!1,location:{lat:36.604,lng:-93.248,accuracy:11,speed:21,heading:96,recorded_at:t},last_seen_seconds_ago:13},{participant_id:104,name:"Linda Perez",gender:null,avatar_url:null,vehicle_color:"Black",vehicle_description:"Kia Telluride",is_leader:!1,is_current_user:!1,location:{lat:36.597,lng:-93.214,accuracy:14,speed:16,heading:92,recorded_at:t},last_seen_seconds_ago:36}]),r(V,[{id:1,name:"Fuel + regroup",description:"Top off and verify all vans are accounted for.",lat:36.621,lng:-93.295,order:1,eta:new Date(o+1500*1e3).toISOString()},{id:2,name:"Prayer circle",description:"10-minute devotion and route update.",lat:36.634,lng:-93.252,order:2,eta:new Date(o+3300*1e3).toISOString()},{id:3,name:"Arrive at retreat camp",description:"Unload and check in by group name.",lat:36.641,lng:-93.219,order:3,eta:new Date(o+5400*1e3).toISOString()}]),r(Me,[{id:1,message_type:"chat",content:"All vehicles are rolling. Next checkpoint in ~25 minutes.",sender:{id:101,name:"Chris Hogg",is_leader:!0,gender:null,avatar_url:null},location:null,created_at:new Date(o-480*1e3).toISOString()},{id:2,message_type:"chat",content:"üôè Prayer Request: please pray for safe travel and calm weather.",sender:{id:102,name:"Sarah Jenkins",is_leader:!1,gender:null,avatar_url:null},location:null,created_at:new Date(o-240*1e3).toISOString()},{id:3,message_type:"alert",content:"[HIGH] Keep hazard lights on for reduced visibility zone ahead.",sender:{id:101,name:"Chris Hogg",is_leader:!0,gender:null,avatar_url:null},location:null,created_at:new Date(o-120*1e3).toISOString()}]),r(Ve,"Silver"),r($e,"Ford F-150"),r(C,!0),r(f,!0),r(Ie,"Demo mode active from ?demo=1 for visual sharing.")}wt(async()=>{r(g,navigator.onLine);const t=localStorage.getItem(x);if((t==="day"||t==="night")&&r(i,t),new URLSearchParams(window.location.search).get("demo")==="1")nt();else{const O=localStorage.getItem(h);if(O){q=O;try{await wa(O)}catch{localStorage.removeItem(h),q="",r(f,!0)}}else r(f,!0)}const w=async()=>{r(g,!0),await Ca(),await je()},E=()=>{r(g,!1),r(Ie,"You are offline. New messages will be queued.")};return window.addEventListener("online",w),window.addEventListener("offline",E),sa=setInterval(()=>{e(C)&&e(g)&&je()},2e4),()=>{window.removeEventListener("online",w),window.removeEventListener("offline",E),sa&&clearInterval(sa)}}),Ze(()=>e(F),()=>{r(v,e(F).filter(t=>(t.last_seen_seconds_ago??9999)<300).length)}),Ze(()=>e(F),()=>{r(c,e(F).filter(t=>t.location!==null))}),Ze(()=>e(I),()=>{r(p,e(I)?.is_leader===!0)}),Ze(()=>e(me),()=>{r(d,e(me).length)}),Ze(()=>e(i),()=>{e(i)==="night"&&typeof document<"u"?document.body.classList.add("theme-night"):typeof document<"u"&&document.body.classList.remove("theme-night")}),zt(),yt();var ka=Or(),Ta=da(ka);{var ot=t=>{var o=nr();S(t,o)},it=t=>{var o=or(),P=l(o),w=n(l(P),2),E=l(w),O=n(l(E));Be(O),s(E);var se=n(E,2),ve=n(l(se));Be(ve),s(se);var be=n(se,2),le=l(be),ye=n(l(le));Be(ye),s(le);var he=n(le,2),ge=n(l(he));Be(ge),s(he),s(be);var De=n(be,2),Ke=l(De,!0);s(De),s(w);var Le=n(w,2),Je=l(Le),la=l(Je,!0);s(Je),s(Le),s(P),s(o),K(()=>{De.disabled=e(b),m(Ke,e(b)?"Joining‚Ä¶":"Start the Journey"),m(la,e(i)==="day"?"üåô Night mode":"‚òÄÔ∏è Day mode")}),He(O,()=>e(Se),Ee=>r(Se,Ee)),R("input",O,Ee=>{const na=Ee.currentTarget;r(Se,ma(na.value))}),He(ve,()=>e(Te),Ee=>r(Te,Ee)),He(ye,()=>e(ie),Ee=>r(ie,Ee)),He(ge,()=>e(xe),Ee=>r(xe,Ee)),R("submit",w,rr(Ka)),R("click",Je,()=>{r(i,e(i)==="day"?"night":"day"),localStorage.setItem(x,e(i))}),S(t,o)},ct=t=>{var o=Dr(),P=l(o),w=l(P),E=l(w),O=l(E,!0);s(E);var se=n(E,4),ve=l(se);s(se),s(w);var be=n(w,2),le=l(be),ye=l(le,!0);s(le);var he=n(le,2),ge=l(he,!0);s(he),s(be),s(P);var De=n(P,2);{var Ke=z=>{var k=ir(),H=l(k),Q=l(H),de=l(Q,!0);s(Q);var L=n(Q,2),J=l(L);{var ae=D=>{var T=Na();K(()=>m(T,`${e(d)??""} queued message${e(d)===1?"":"s"} waiting to send.`)),S(D,T)},$=D=>{var T=Na("You can keep using the app ‚Äî new messages will sync when your signal returns.");S(D,T)};fe(J,D=>{e(g)?D(ae):D($,!1)})}s(L),s(H);var ce=n(H,2);s(k),K(()=>m(de,e(g)?"Queued updates ready":"Offline mode active")),R("click",ce,st),S(z,k)};fe(De,z=>{(!e(g)||e(d)>0)&&z(Ke)})}var Le=n(De,2);Qe(Le,5,()=>Ba,Ye,(z,k)=>{var H=cr();let Q;var de=l(H),L=l(de,!0);s(de);var J=n(de,2),ae=l(J,!0);s(J),s(H),K(()=>{Q=qe(H,1,"svelte-1uha8ag",null,Q,{active:e(Y)===e(k).id}),m(L,(e(k),_(()=>e(k).icon))),m(ae,(e(k),_(()=>e(k).label)))}),R("click",H,()=>r(Y,e(k).id)),S(z,H)}),s(Le);var Je=n(Le,2);{var la=z=>{var k=hr(),H=l(k),Q=n(l(H),2),de=l(Q,!0);s(Q),s(H);var L=n(H,2),J=n(l(L),4);{var ae=D=>{var T=ur();S(D,T)},$=D=>{var T=Ia(),G=da(T);Qe(G,1,()=>e(F),Ye,(ue,B,W)=>{const A=Va(()=>(e(B),_(()=>za(e(B),W))));var M=vr(),X=l(M),we=l(X,!0);s(X);var te=n(X,2),Ae=l(te,!0);s(te),s(M),K(re=>{qe(M,1,(e(B),_(()=>`marker ${e(B).is_current_user?"me":""}`)),"svelte-1uha8ag"),tr(M,(Qt(e(A)),_(()=>`left:${e(A).x}%; top:${e(A).y}%;`))),m(we,(e(B),_(()=>e(B).is_leader?"‚≠ê":"üöó"))),m(Ae,re)},[()=>(e(B),_(()=>e(B).name.split(" ")[0]))]),R("click",M,()=>Ea(e(B))),S(ue,M)}),S(D,T)};fe(J,D=>{e(c),_(()=>e(c).length===0)?D(ae):D($,!1)})}s(L);var ce=n(L,2);Qe(ce,5,()=>e(F),Ye,(D,T)=>{var G=dr(),ue=l(G),B=l(ue,!0);s(ue);var W=n(ue,2),A=l(W,!0);s(W);var M=n(W,2),X=l(M,!0);s(M),s(G),K(we=>{m(B,(e(T),_(()=>e(T).is_leader?"‚≠ê":"üë§"))),m(A,(e(T),_(()=>e(T).name))),m(X,we)},[()=>(e(T),_(()=>ya(e(T).last_seen_seconds_ago)))]),R("click",G,()=>Ea(e(T))),S(D,G)}),s(ce),s(k),K(()=>m(de,(e(Z),_(()=>e(Z)?.destination?.name?`Destination: ${e(Z).destination.name}`:"Destination syncing‚Ä¶")))),S(z,k)},Ee=z=>{var k=_r(),H=n(l(k),2);{var Q=L=>{var J=fr();S(L,J)},de=L=>{var J=pr();Qe(J,5,()=>e(V),Ye,(ae,$,ce)=>{var D=gr(),T=l(D),G=n(T,2),ue=l(G);ue.textContent=`Stop ${ce+1}`;var B=n(ue,2),W=l(B,!0);s(B);var A=n(B,2),M=l(A,!0);s(A);var X=n(A,2),we=l(X);s(X),s(G),s(D),K((te,Ae)=>{qe(T,1,`timeline-dot ${te??""}`,"svelte-1uha8ag"),m(W,(e($),_(()=>e($).name))),m(M,(e($),_(()=>e($).description??"No additional note."))),m(we,`ETA ${Ae??""}`)},[()=>(e($),_(()=>new Date(e($).eta??"").getTime()<Date.now()?"done":"")),()=>(e($),_(()=>ba(e($).eta)))]),S(ae,D)}),s(J),S(L,J)};fe(H,L=>{e(V),_(()=>e(V).length===0)?L(Q):L(de,!1)})}s(k),S(z,k)},na=z=>{var k=wr(),H=n(l(k),2),Q=l(H);{var de=A=>{var M=mr();S(A,M)},L=A=>{var M=Ia(),X=da(M);Qe(X,1,()=>e(Me),Ye,(we,te)=>{var Ae=br(),re=l(Ae),pe=l(re),oa=l(pe,!0);s(pe);var ta=n(pe,2),_t=l(ta,!0);s(ta),s(re);var Ma=n(re,2),mt=l(Ma,!0);s(Ma),s(Ae),K(bt=>{qe(Ae,1,(e(te),_(()=>`chat-item ${e(te).message_type==="alert"?"alert":""}`)),"svelte-1uha8ag"),m(oa,(e(te),_(()=>e(te).sender.name))),m(_t,bt),m(mt,(e(te),_(()=>e(te).content)))},[()=>(e(te),_(()=>ba(e(te).created_at)))]),S(we,Ae)}),S(A,M)};fe(Q,A=>{e(Me),_(()=>e(Me).length===0)?A(de):A(L,!1)})}s(H);var J=n(H,2),ae=l(J),$=l(ae);let ce;var D=n($,2);let T;s(ae);var G=n(ae,2);qa(G);var ue=n(G,2),B=n(ue,2);{var W=A=>{var M=yr(),X=l(M,!0);s(M),K(()=>m(X,e(Ie))),S(A,M)};fe(B,A=>{e(Ie)&&A(W)})}s(J),s(k),K(()=>{ce=qe($,1,"svelte-1uha8ag",null,ce,{active:e(oe)==="chat"}),T=qe(D,1,"svelte-1uha8ag",null,T,{active:e(oe)==="prayer"}),Ha(G,"placeholder",e(oe)==="prayer"?"Share a prayer need for the caravan‚Ä¶":"Send a convoy update‚Ä¶")}),R("click",$,()=>r(oe,"chat")),R("click",D,()=>r(oe,"prayer")),He(G,()=>e(Ue),A=>r(Ue,A)),R("click",ue,Ya),S(z,k)},gt=z=>{var k=Er(),H=n(l(k),2);{var Q=L=>{var J=Sr();S(L,J)},de=L=>{var J=Cr(),ae=l(J);Qe(ae,4,()=>["low","medium","high","critical"],Ye,(W,A)=>{var M=xr();let X;var we=l(M,!0);s(M),K(()=>{X=qe(M,1,"svelte-1uha8ag",null,X,{active:e(Ce)===A}),m(we,A)}),R("click",M,()=>r(Ce,A)),S(W,M)}),s(ae);var $=n(ae,2);qa($);var ce=n($,2),D=n(l(ce),2),T=l(D),G=l(T);s(T);var ue=n(T);s(D),s(ce);var B=n(ce,2);s(J),K(W=>{m(G,`[${W??""}]`),m(ue,` ${(e(Fe)||"No message yet.")??""}`)},[()=>(e(Ce),_(()=>e(Ce).toUpperCase()))]),He($,()=>e(Fe),W=>r(Fe,W)),R("click",B,()=>r(We,!0)),S(L,J)};fe(H,L=>{e(p)?L(de,!1):L(Q)})}s(k),S(z,k)},pt=z=>{var k=Pr(),H=n(l(k),2),Q=l(H),de=l(Q);{var L=re=>{var pe=kr();K(()=>Ha(pe,"src",(e(I),_(()=>e(I).avatar_url)))),S(re,pe)},J=re=>{var pe=Tr(),oa=l(pe,!0);s(pe),K(ta=>m(oa,ta),[()=>(e(I),_(()=>e(I)?.name?.slice(0,1)??"C"))]),S(re,pe)};fe(de,re=>{e(I),_(()=>e(I)?.avatar_url)?re(L):re(J,!1)})}s(Q);var ae=n(Q,2),$=l(ae),ce=n(l($));Be(ce),s($);var D=n($,2),T=n(l(D));Be(T),s(D);var G=n(D,2),ue=n(l(G));Be(ue),s(G),s(ae),s(H);var B=n(H,2),W=l(B),A=l(W),M=n(A);s(W);var X=n(W,2),we=n(X,2),te=n(we,2),Ae=l(te,!0);s(te),s(B),s(k),K(()=>{Gt(ce,(e(I),_(()=>e(I)?.name??""))),m(A,`${e(j)?"Uploading‚Ä¶":"Upload profile photo"} `),M.disabled=e(j),X.disabled=e(j),te.disabled=e(U),m(Ae,e(U)?"Leaving‚Ä¶":"Leave retreat")}),He(T,()=>e(Ve),re=>r(Ve,re)),He(ue,()=>e($e),re=>r($e,re)),R("change",M,re=>{const pe=re.currentTarget;at(pe.files?.[0]??null),pe.value=""}),R("click",X,tt),R("click",we,()=>Oe("Vehicle detail save endpoint is next backend step.")),R("click",te,rt),S(z,k)};fe(Je,z=>{e(Y)==="map"?z(la):e(Y)==="waypoints"?z(Ee,1):e(Y)==="chat"?z(na,2):e(Y)==="alert"?z(gt,3):e(Y)==="profile"&&z(pt,4)})}s(o),K(()=>{qe(o,1,`app-shell ${e(i)==="night"?"night":""}`,"svelte-1uha8ag"),m(O,(e(Z),_(()=>e(Z)?.name??"Calvary Caravan"))),m(ve,`${e(v)??""}/${e(F),_(()=>e(F).length)??""} online ¬∑ ${e(Z),e(F),_(()=>e(Z)?.participant_count??e(F).length)??""} total`),m(ye,e(i)==="day"?"üåô":"‚òÄÔ∏è"),he.disabled=e(ne),m(ge,e(ne)?"‚Ä¶":"‚Üª")}),R("click",le,()=>{r(i,e(i)==="day"?"night":"day"),localStorage.setItem(x,e(i))}),R("click",he,je),S(t,o)};fe(Ta,t=>{e(f)?e(C)?t(ct,!1):t(it,1):t(ot)})}var Pa=n(Ta,2);{var ut=t=>{var o=Ar(),P=l(o),w=n(P,2),E=l(w),O=l(E),se=l(O,!0);s(O);var ve=n(O,2),be=l(ve);s(ve),s(E);var le=n(E,2),ye=l(le),he=n(ye,2),ge=n(he,2),De=n(ge,2);s(le);var Ke=n(le,2),Le=l(Ke);s(Ke),s(w),s(o),K(Je=>{m(se,(e(ee),_(()=>e(ee).name))),m(be,`${e(ee),_(()=>e(ee).vehicle_color??"Vehicle TBD")??""} ¬∑ ${e(ee),_(()=>e(ee).vehicle_description??"Description TBD")??""}`),m(Le,`Last seen: ${Je??""}`)},[()=>(e(ee),_(()=>ya(e(ee).last_seen_seconds_ago)))]),R("click",P,Ga),R("click",ye,()=>et(e(ee))),R("click",he,()=>Wa(e(ee))),R("click",ge,()=>Xa(e(ee))),R("click",De,()=>Za(e(ee))),S(t,o)};fe(Pa,t=>{e(ee)&&t(ut)})}var Da=n(Pa,2);{var vt=t=>{var o=Mr(),P=l(o),w=n(P,2),E=n(l(w),2),O=n(l(E)),se=l(O,!0);s(O),Yt(),s(E);var ve=n(E,2),be=l(ve);s(ve);var le=n(ve,2),ye=l(le),he=n(ye,2);s(le),s(w),s(o),K((ge,De)=>{m(se,ge),m(be,`[${De??""}] ${(e(Fe)||"No message entered.")??""}`)},[()=>(e(Ce),_(()=>e(Ce).toUpperCase())),()=>(e(Ce),_(()=>e(Ce).toUpperCase()))]),R("click",P,()=>r(We,!1)),R("click",ye,()=>r(We,!1)),R("click",he,Qa),S(t,o)};fe(Da,t=>{e(We)&&t(vt)})}var Aa=n(Da,2);{var dt=t=>{var o=Nr(),P=l(o);s(o),K(()=>m(P,`‚ö†Ô∏è ${e(ze)??""}`)),S(t,o)};fe(Aa,t=>{e(ze)&&t(dt)})}var ht=n(Aa,2);{var ft=t=>{var o=Ir(),P=l(o);s(o),K(()=>m(P,`‚úÖ ${e(Xe)??""}`)),S(t,o)};fe(ht,t=>{e(Xe)&&t(ft)})}S(a,ka),Kt()}export{$r as component};
