import{i as oe,_ as rr,b as nr}from"../chunks/DOj_L230.js";import{a as C,f as A,t as wa,c as lr}from"../chunks/Cqtqrt0G.js";import{i as sr}from"../chunks/BTI8y7Wc.js";import{o as or}from"../chunks/-eHITvjr.js";import{h as Ve,P as Fa,X as ir,e as qa,H as cr,G as ur,t as e,J as vr,M as dr,O as it,Q as $a,i as Da,V as fr,ax as hr,ah as ct,c as ca,f as Ua,aR as pr,s as gr,aJ as _r,aS as mr,av as Ja,aT as br,a5 as ut,aU as yr,aV as wr,aN as m,aW as je,r as mt,p as bt,aX as Ha,aY as Sr,au as xr,d as Cr,W as Er,aZ as yt,q as kr,a_ as Tr,a$ as Nr,aO as Pr,l as x,S as Dr,b0 as Ar,z as Lr,b1 as Ye,b2 as Or,A as vt,C as Mr,aD as t,F as o,D as s,E as l,B as Z,ai as dt,b3 as ft}from"../chunks/B9mbK8lt.js";import{s as w,e as F}from"../chunks/AFsuBYVU.js";import{r as $e,s as ht,a as pt}from"../chunks/DDxyQvBn.js";function Sa(r,v){return v}function Ir(r,v,u){for(var i=[],b=v.length,f,h=v.length,N=0;N<b;N++){let ie=v[N];bt(ie,()=>{if(f){if(f.pending.delete(ie),f.done.add(ie),f.pending.size===0){var $=r.outrogroups;Ba(Ja(f.done)),$.delete(f),$.size===0&&(r.outrogroups=null)}}else h-=1},!1)}if(h===0){var _=i.length===0&&u!==null;if(_){var y=u,E=y.parentNode;xr(E),E.append(y),r.items.clear()}Ba(v,!_)}else f={pending:new Set(v),done:new Set},(r.outrogroups??=new Set).add(f)}function Ba(r,v=!0){for(var u=0;u<r.length;u++)Cr(r[u],v)}var gt;function xa(r,v,u,i,b,f=null){var h=r,N=new Map,_=(v&yt)!==0;if(_){var y=r;h=Ve?Fa(ir(y)):y.appendChild(qa())}Ve&&cr();var E=null,ie=_r(()=>{var p=u();return mr(p)?p:p==null?[]:Ja(p)}),$,Y=!0;function he(){d.fallback=E,Rr(d,$,h,v,i),E!==null&&($.length===0?(E.f&je)===0?mt(E):(E.f^=je,Ea(E,null,h)):bt(E,()=>{E=null}))}var H=ur(()=>{$=e(ie);var p=$.length;let X=!1;if(Ve){var xe=vr(h)===dr;xe!==(p===0)&&(h=it(),Fa(h),$a(!1),X=!0)}for(var ce=new Set,Ce=ca,Ne=gr(),re=0;re<p;re+=1){Ve&&Da.nodeType===fr&&Da.data===hr&&(h=Da,X=!0,$a(!1));var k=$[re],V=i(k,re),P=Y?null:N.get(V);P?(P.v&&ct(P.v,k),P.i&&ct(P.i,re),Ne&&Ce.unskip_effect(P.e)):(P=Fr(N,Y?h:gt??=qa(),k,V,re,b,v,u),Y||(P.e.f|=je),N.set(V,P)),ce.add(V)}if(p===0&&f&&!E&&(Y?E=Ua(()=>f(h)):(E=Ua(()=>f(gt??=qa())),E.f|=je)),p>ce.size&&pr(),Ve&&p>0&&Fa(it()),!Y)if(Ne){for(const[z,Ie]of N)ce.has(z)||Ce.skip_effect(Ie.e);Ce.oncommit(he),Ce.ondiscard(()=>{})}else he();X&&$a(!0),e(ie)}),d={effect:H,items:N,outrogroups:null,fallback:E};Y=!1,Ve&&(h=Da)}function Ca(r){for(;r!==null&&(r.f&Sr)===0;)r=r.next;return r}function Rr(r,v,u,i,b){var f=(i&Tr)!==0,h=v.length,N=r.items,_=Ca(r.effect.first),y,E=null,ie,$=[],Y=[],he,H,d,p;if(f)for(p=0;p<h;p+=1)he=v[p],H=b(he,p),d=N.get(H).e,(d.f&je)===0&&(d.nodes?.a?.measure(),(ie??=new Set).add(d));for(p=0;p<h;p+=1){if(he=v[p],H=b(he,p),d=N.get(H).e,r.outrogroups!==null)for(const P of r.outrogroups)P.pending.delete(d),P.done.delete(d);if((d.f&je)!==0)if(d.f^=je,d===_)Ea(d,null,u);else{var X=E?E.next:_;d===r.effect.last&&(r.effect.last=d.prev),d.prev&&(d.prev.next=d.next),d.next&&(d.next.prev=d.prev),ze(r,E,d),ze(r,d,X),Ea(d,X,u),E=d,$=[],Y=[],_=Ca(E.next);continue}if((d.f&Ha)!==0&&(mt(d),f&&(d.nodes?.a?.unfix(),(ie??=new Set).delete(d))),d!==_){if(y!==void 0&&y.has(d)){if($.length<Y.length){var xe=Y[0],ce;E=xe.prev;var Ce=$[0],Ne=$[$.length-1];for(ce=0;ce<$.length;ce+=1)Ea($[ce],xe,u);for(ce=0;ce<Y.length;ce+=1)y.delete(Y[ce]);ze(r,Ce.prev,Ne.next),ze(r,E,Ce),ze(r,Ne,xe),_=xe,E=Ne,p-=1,$=[],Y=[]}else y.delete(d),Ea(d,_,u),ze(r,d.prev,d.next),ze(r,d,E===null?r.effect.first:E.next),ze(r,E,d),E=d;continue}for($=[],Y=[];_!==null&&_!==d;)(y??=new Set).add(_),Y.push(_),_=Ca(_.next);if(_===null)continue}(d.f&je)===0&&$.push(d),E=d,_=Ca(d.next)}if(r.outrogroups!==null){for(const P of r.outrogroups)P.pending.size===0&&(Ba(Ja(P.done)),r.outrogroups?.delete(P));r.outrogroups.size===0&&(r.outrogroups=null)}if(_!==null||y!==void 0){var re=[];if(y!==void 0)for(d of y)(d.f&Ha)===0&&re.push(d);for(;_!==null;)(_.f&Ha)===0&&_!==r.fallback&&re.push(_),_=Ca(_.next);var k=re.length;if(k>0){var V=(i&yt)!==0&&h===0?u:null;if(f){for(p=0;p<k;p+=1)re[p].nodes?.a?.measure();for(p=0;p<k;p+=1)re[p].nodes?.a?.fix()}Ir(r,re,V)}}f&&kr(()=>{if(ie!==void 0)for(d of ie)d.nodes?.a?.apply()})}function Fr(r,v,u,i,b,f,h,N){var _=(h&yr)!==0?(h&wr)===0?m(u,!1,!1):ut(u):null,y=(h&br)!==0?ut(b):null;return{v:_,i:y,e:Ua(()=>(f(v,_??u,y??b,N),()=>{r.delete(i)}))}}function Ea(r,v,u){if(r.nodes)for(var i=r.nodes.start,b=r.nodes.end,f=v&&(v.f&je)===0?v.nodes.start:u;i!==null;){var h=Er(i);if(f.before(i),i===b)return;i=h}}function ze(r,v,u){v===null?r.effect.first=u:v.next=u,u===null?r.effect.last=v:u.prev=v}function wt(r){var v,u,i="";if(typeof r=="string"||typeof r=="number")i+=r;else if(typeof r=="object")if(Array.isArray(r)){var b=r.length;for(v=0;v<b;v++)r[v]&&(u=wt(r[v]))&&(i&&(i+=" "),i+=u)}else for(u in r)r[u]&&(i&&(i+=" "),i+=u);return i}function qr(){for(var r,v,u=0,i="",b=arguments.length;u<b;u++)(r=arguments[u])&&(v=wt(r))&&(i&&(i+=" "),i+=v);return i}function $r(r){return typeof r=="object"?qr(r):r??""}const _t=[...` 	
\r\f¬†\v\uFEFF`];function Hr(r,v,u){var i=r==null?"":""+r;if(v&&(i=i?i+" "+v:v),u){for(var b in u)if(u[b])i=i?i+" "+b:b;else if(i.length)for(var f=b.length,h=0;(h=i.indexOf(b,h))>=0;){var N=h+f;(h===0||_t.includes(i[h-1]))&&(N===i.length||_t.includes(i[N]))?i=(h===0?"":i.substring(0,h))+i.substring(N+1):h=N}}return i===""?null:i}function We(r,v,u,i,b,f){var h=r.__className;if(Ve||h!==u||h===void 0){var N=Hr(u,i,f);(!Ve||N!==r.getAttribute("class"))&&(N==null?r.removeAttribute("class"):r.className=N),r.__className=u}else if(f&&b!==f)for(var _ in f){var y=!!f[_];(b==null||y!==!!b[_])&&r.classList.toggle(_,y)}return f}function He(r,v,u=v){var i=new WeakSet;Nr(r,"input",async b=>{var f=b?r.defaultValue:r.value;if(f=Va(r)?ja(f):f,u(f),ca!==null&&i.add(ca),await Pr(),f!==(f=v())){var h=r.selectionStart,N=r.selectionEnd,_=r.value.length;if(r.value=f??"",N!==null){var y=r.value.length;h===N&&N===_&&y>_?(r.selectionStart=y,r.selectionEnd=y):(r.selectionStart=h,r.selectionEnd=Math.min(N,y))}}}),(Ve&&r.defaultValue!==r.value||x(v)==null&&r.value)&&(u(Va(r)?ja(r.value):r.value),ca!==null&&i.add(ca)),Dr(()=>{var b=v();if(r===document.activeElement){var f=Ar??ca;if(i.has(f))return}Va(r)&&b===ja(r.value)||r.type==="date"&&!b&&!r.value||b!==r.value&&(r.value=b??"")})}function Va(r){var v=r.type;return v==="number"||v==="range"}function ja(r){return r===""?null:+r}function Vr(r){return function(...v){var u=v[0];return u.preventDefault(),r?.apply(this,v)}}const jr="/api/v1/retreat";function Ur(r,v){if(!r)return`Request failed (${v})`;try{const u=JSON.parse(r);if(u.error)return u.error;if(u.message)return u.message;if(u.errors&&typeof u.errors=="object"){const i=Object.values(u.errors)[0];if(Array.isArray(i)&&i.length>0)return String(i[0]);if(typeof i=="string")return i}}catch{}return r}async function fe(r,v={},u){const i=new Headers(v.headers??{});i.set("Accept","application/json"),v.body&&!i.has("Content-Type")&&i.set("Content-Type","application/json"),u&&i.set("X-Device-Token",u);const b=await fetch(`${jr}${r}`,{...v,headers:i});if(!b.ok){const f=await b.text();throw new Error(Ur(f,b.status))}return await b.json()}var Br=A('<main class="boot-screen svelte-1uha8ag"><h1>Loading Calvary Caravan‚Ä¶</h1> <p>Syncing your convoy workspace.</p></main>'),Jr=A('<main class="join-shell svelte-1uha8ag"><section class="join-card svelte-1uha8ag"><div class="join-header svelte-1uha8ag"><span class="eyebrow svelte-1uha8ag">Calvary Caravan</span> <h1 class="svelte-1uha8ag">Join the Retreat</h1> <p class="svelte-1uha8ag">Enter your retreat code, phone number, and basic details to sync with your group on the road.</p></div> <form class="join-form svelte-1uha8ag"><label class="svelte-1uha8ag">6-character invite code <input maxlength="6" placeholder="TEST26" required="" class="svelte-1uha8ag"/></label> <label class="svelte-1uha8ag">Full name <input maxlength="50" placeholder="e.g. Sarah Jenkins" required="" class="svelte-1uha8ag"/></label> <label class="svelte-1uha8ag">Phone number (used for retreat identity) <input type="tel" inputmode="tel" autocomplete="tel" maxlength="24" placeholder="e.g. (501) 231-5761" required="" class="svelte-1uha8ag"/></label> <div class="split-fields svelte-1uha8ag"><label class="svelte-1uha8ag">Vehicle color <input maxlength="30" placeholder="e.g. Silver" class="svelte-1uha8ag"/></label> <label class="svelte-1uha8ag">Make/model <input maxlength="50" placeholder="e.g. Honda CR-V" class="svelte-1uha8ag"/></label></div> <button type="submit" class="svelte-1uha8ag"> </button></form> <aside class="join-notes svelte-1uha8ag"><p class="svelte-1uha8ag"><strong>Permission notes for store review:</strong></p> <ul class="svelte-1uha8ag"><li>Your phone number is used as your retreat identity (no OTP in this version).</li> <li>Location is used only while the app is active so your marker can update on the convoy map.</li> <li>You can delete your account data anytime in Profile ‚Üí Delete account &amp; data.</li></ul> <p class="join-links svelte-1uha8ag"><a href="/privacy" target="_blank" rel="noopener noreferrer" class="svelte-1uha8ag">Privacy</a> ¬∑ <a href="/support" target="_blank" rel="noopener noreferrer" class="svelte-1uha8ag">Support</a> ¬∑ <a href="/account-deletion" target="_blank" rel="noopener noreferrer" class="svelte-1uha8ag">Account deletion</a></p></aside> <div class="join-footer"><button type="button" class="theme-toggle svelte-1uha8ag"> </button></div></section></main>'),Yr=A('<section class="status-banner card svelte-1uha8ag"><div><strong> </strong> <p class="svelte-1uha8ag"><!></p></div> <button type="button" class="small svelte-1uha8ag">Retry now</button></section>'),zr=A('<button type="button"><span> </span> <small class="svelte-1uha8ag"> </small></button>'),Wr=A('<div class="map-empty svelte-1uha8ag"><strong>No live markers yet</strong> <p class="svelte-1uha8ag">Allow location while using the app so your marker can appear on the live map.</p></div>'),Kr=A('<button type="button" class="pill svelte-1uha8ag"><span> </span> <span class="pill-main svelte-1uha8ag"><span class="pill-name svelte-1uha8ag"> </span> <small class="pill-near svelte-1uha8ag"> </small></span> <small class="svelte-1uha8ag"> </small></button>'),Zr=A('<section class="map-panel card svelte-1uha8ag"><div class="panel-head svelte-1uha8ag"><h3 class="svelte-1uha8ag">Live Convoy Map</h3> <p class="svelte-1uha8ag"> </p></div> <div class="map-canvas svelte-1uha8ag"><div class="map-live svelte-1uha8ag" aria-label="Live map"></div> <!></div> <p class="map-attribution svelte-1uha8ag" role="note" aria-label="Map attribution"><a href="https://leafletjs.com" target="_blank" rel="noopener noreferrer" class="svelte-1uha8ag">Leaflet</a> <span aria-hidden="true">‚Ä¢</span> <span>Map data ¬© <a href="https://www.openstreetmap.org/copyright" target="_blank" rel="noopener noreferrer" class="svelte-1uha8ag">OpenStreetMap contributors</a></span></p> <div class="participant-row svelte-1uha8ag"></div></section>'),Qr=A('<div class="empty-state svelte-1uha8ag"><strong>No waypoints loaded</strong> <p class="svelte-1uha8ag">Waypoints from the retreat route will show here automatically.</p></div>'),Gr=A('<article class="timeline-card svelte-1uha8ag"><div></div> <div><p class="eyebrow svelte-1uha8ag"></p> <h4 class="svelte-1uha8ag"> </h4> <p class="svelte-1uha8ag"> </p> <small class="svelte-1uha8ag"> </small></div></article>'),Xr=A('<div class="timeline svelte-1uha8ag"></div>'),en=A('<section class="panel card svelte-1uha8ag"><div class="panel-head svelte-1uha8ag"><h3 class="svelte-1uha8ag">Waypoints & Schedule</h3> <p class="svelte-1uha8ag">Keep everyone aligned on ETAs and checkpoint progress.</p></div> <!></section>'),an=A('<div class="empty-state svelte-1uha8ag"><strong>No messages yet</strong> <p class="svelte-1uha8ag">Start with a quick check-in for the group.</p></div>'),tn=A('<article><header class="svelte-1uha8ag"><strong> </strong> <small class="svelte-1uha8ag"> </small></header> <p class="svelte-1uha8ag"> </p></article>'),rn=A('<small class="subtle svelte-1uha8ag"> </small>'),nn=A('<section class="panel card svelte-1uha8ag"><div class="panel-head svelte-1uha8ag"><h3 class="svelte-1uha8ag">Group Chat</h3> <p class="svelte-1uha8ag">Use chat for normal updates and prayer mode for care moments.</p></div> <div class="chat-list svelte-1uha8ag"><!></div> <div class="composer svelte-1uha8ag"><div class="mode-toggle svelte-1uha8ag"><button type="button">Chat</button> <button type="button">Prayer Request</button></div> <textarea rows="3" class="svelte-1uha8ag"></textarea> <button type="button" class="svelte-1uha8ag">Send</button> <!></div></section>'),ln=A('<div class="empty-state svelte-1uha8ag"><strong>Leader access required</strong> <p class="svelte-1uha8ag">You can receive alerts here, but only leaders can broadcast emergency notices.</p></div>'),sn=A('<button type="button"> </button>'),on=A('<div class="alert-builder svelte-1uha8ag"><div class="severity-grid svelte-1uha8ag"></div> <textarea rows="4" placeholder="Describe the urgent issue and what the group should do next." class="svelte-1uha8ag"></textarea> <div class="alert-preview card svelte-1uha8ag"><p class="eyebrow svelte-1uha8ag">Preview</p> <p class="svelte-1uha8ag"><strong> </strong> </p></div> <button type="button" class="danger svelte-1uha8ag">Send emergency alert</button></div>'),cn=A('<section class="panel card svelte-1uha8ag"><div class="panel-head svelte-1uha8ag"><h3 class="svelte-1uha8ag">Emergency Alert Composer</h3> <p class="svelte-1uha8ag">Leader-only high-signal channel with confirmation safeguard.</p></div> <!></section>'),un=A('<img alt="Profile" class="svelte-1uha8ag"/>'),vn=A('<div class="avatar-fallback svelte-1uha8ag"> </div>'),dn=A(`<section class="panel card svelte-1uha8ag"><div class="panel-head svelte-1uha8ag"><h3 class="svelte-1uha8ag">Profile & Vehicle</h3> <p class="svelte-1uha8ag">Keep your details current so others can identify you quickly on the road.</p></div> <article class="profile-card card svelte-1uha8ag"><div class="avatar-wrap svelte-1uha8ag"><!></div> <div class="profile-fields svelte-1uha8ag"><label class="svelte-1uha8ag">Name <input readonly="" class="svelte-1uha8ag"/></label> <label class="svelte-1uha8ag">Phone identity <input readonly="" class="svelte-1uha8ag"/></label> <label class="svelte-1uha8ag">Vehicle color <input placeholder="e.g. Silver" class="svelte-1uha8ag"/></label> <label class="svelte-1uha8ag">Make/model <input placeholder="e.g. Honda CR-V" class="svelte-1uha8ag"/></label></div></article> <article class="location-sharing card svelte-1uha8ag"><div><p class="eyebrow svelte-1uha8ag">Privacy</p> <h4 class="svelte-1uha8ag"> </h4> <p class="svelte-1uha8ag">Turn this off anytime to remove your marker from the live map. You can still use chat and waypoints.
              For best results, allow location while using the app in your phone settings.</p></div> <button type="button"><!></button></article> <div class="profile-actions svelte-1uha8ag"><label class="upload-btn svelte-1uha8ag"> <input type="file" accept="image/png,image/jpeg,image/webp" class="svelte-1uha8ag"/></label> <button type="button" class="ghost svelte-1uha8ag">Remove photo</button> <button type="button" class="ghost svelte-1uha8ag">Save vehicle details</button> <button type="button" class="danger-outline svelte-1uha8ag"> </button> <button type="button" class="danger svelte-1uha8ag"> </button></div></section>`),fn=A('<main><header class="topbar card svelte-1uha8ag"><div><p class="eyebrow svelte-1uha8ag"> </p> <h2 class="svelte-1uha8ag">Convoy Control</h2> <p class="subtle svelte-1uha8ag"> </p></div> <div class="topbar-actions svelte-1uha8ag"><button type="button" class="ghost svelte-1uha8ag"> </button> <button type="button" class="ghost svelte-1uha8ag"> </button></div></header> <!> <nav class="tabbar card svelte-1uha8ag"></nav> <!></main>'),hn=A('<span class="svelte-1uha8ag"> </span>'),pn=A('<p class="place-label-line svelte-1uha8ag"> <!></p>'),gn=A('<section class="sheet-backdrop svelte-1uha8ag" aria-label="Participant quick actions"><button type="button" class="sheet-hitbox svelte-1uha8ag" aria-label="Close participant quick actions"></button> <article class="participant-sheet card svelte-1uha8ag"><header class="svelte-1uha8ag"><h4 class="svelte-1uha8ag"> </h4> <p class="svelte-1uha8ag"> </p> <!></header> <div class="quick-actions svelte-1uha8ag"><button type="button" class="svelte-1uha8ag">üìû Call</button> <button type="button" class="svelte-1uha8ag">üí¨ Message</button> <button type="button" class="svelte-1uha8ag">üôè Pray</button> <button type="button" class="alert-leader-btn svelte-1uha8ag"><span class="alert-leader-icon svelte-1uha8ag" aria-hidden="true">üö®</span> <span>Alert leader</span></button></div> <small class="subtle svelte-1uha8ag"> </small></article></section>'),_n=A(`<section class="sheet-backdrop svelte-1uha8ag" aria-label="Emergency confirmation"><button type="button" class="sheet-hitbox svelte-1uha8ag" aria-label="Close emergency confirmation"></button> <article class="confirm-modal card svelte-1uha8ag"><h4 class="svelte-1uha8ag">Confirm emergency broadcast</h4> <p class="svelte-1uha8ag">This sends a <strong> </strong> alert to the full retreat group.
        Please confirm this message is accurate.</p> <blockquote class="svelte-1uha8ag"> </blockquote> <div class="confirm-actions svelte-1uha8ag"><button type="button" class="ghost svelte-1uha8ag">Cancel</button> <button type="button" class="danger svelte-1uha8ag">Send now</button></div></article></section>`),mn=A('<aside class="toast error svelte-1uha8ag"> </aside>'),bn=A('<aside class="toast success svelte-1uha8ag"> </aside>'),yn=A("<!> <!> <!> <!> <!>",1);function Nn(r,v){Lr(v,!1);const u=m(),i=m(),b=m(),f=m(),h="caravan_device_token",N="caravan_theme_mode";let _=m(!1),y=m(!1),E=m(!1),ie=m(!1),$=m(!1),Y=m(!1),he=m(!1),H=m("map"),d=m("chat"),p=m("day"),X=m(!0),xe=m(""),ce=m(""),Ce=m(""),Ne=m(""),re=m(""),k=m(""),V=m(null),P=m(null),z=m([]),Ie=m([]),Ke=m([]),Pe=m([]),Ze=m(""),Qe=m(""),Ee=m("high"),ua=m(!1),j=m(null),Ge=m(""),Xe=m(""),la=m(""),va=m(""),Ue=m(""),Aa=null,da=null,La=!1,Oa=!1,ee=m(!0),fa=m(!1),Ya=0,ea=m(null),De=null,M=m(null),Be=null,Ae=!1,sa=0;const St=[{id:"map",label:"Map",icon:"üó∫Ô∏è"},{id:"waypoints",label:"Plan",icon:"üìç"},{id:"chat",label:"Chat",icon:"üí¨"},{id:"alert",label:"Alert",icon:"üö®"},{id:"profile",label:"Profile",icon:"üë§"}];function za(a){return a.trim().toUpperCase().replace(/[^A-Z0-9]/g,"").slice(0,6)}function Wa(a){if(!a)return"TBD";const n=new Date(a);return Number.isNaN(n.getTime())?"TBD":n.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"})}function Ma(a){return a==null?"offline":a<60?"just now":a<3600?`${Math.floor(a/60)}m ago`:`${Math.floor(a/3600)}h ago`}function xt(a){return a==null||!Number.isFinite(a)?"":a<1e3?`${Math.round(a)}m`:`${(a/1e3).toFixed(1)}km`}function Ia(a){const n=a.location?.place?.label?.trim();return n||(ka(a.location?.lat,a.location?.lng)?`Near ${Number(a.location.lat).toFixed(3)}, ${Number(a.location.lng).toFixed(3)}`:"Location unavailable")}function ha(a){return a.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}function ka(a,n){return a==null||n===null||n===void 0||!Number.isFinite(a)||!Number.isFinite(n)||Math.abs(a)>90||Math.abs(n)>180?!1:!(a===0&&n===0)}function Ct(){const a=e(P)?.destination?.lat,n=e(P)?.destination?.lng;return ka(a,n)?{lat:Number(a),lng:Number(n)}:null}function Et(a){return a.filter(n=>ka(n.location?.lat,n.location?.lng))}async function Ka(){if(!(typeof window>"u")&&!(!e(y)||e(H)!=="map")&&e(ea)){if(!De){const a=await rr(()=>import("../chunks/CjPBq9Bq.js").then(n=>n.l),[],import.meta.url);De=a.default??a}if(e(M)&&typeof e(M).getContainer=="function"){const a=e(M).getContainer();(!a||a!==e(ea))&&(e(M).remove(),t(M,null),Be=null,Ae=!1,sa=0)}e(M)||(t(M,De.map(e(ea),{zoomControl:!0,attributionControl:!1})),De.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:"&copy; OpenStreetMap contributors"}).addTo(e(M)),Be=De.layerGroup().addTo(e(M)),Ae=!1,sa=0),Za(),window.requestAnimationFrame(()=>{e(M)?.invalidateSize()})}}function Za(){if(!e(M)||!Be||!De)return;Be.clearLayers();const a=e(i),n=Ct(),c=[];for(const g of a){const D=Number(g.location.lat),ne=Number(g.location.lng),le=g.is_current_user?"#1f9e59":g.is_leader?"#8f0030":"#2458c6",we=De.circleMarker([D,ne],{radius:g.is_current_user?9:7,color:le,weight:g.is_current_user?3:2,fillColor:le,fillOpacity:.9}),me=Ia(g);we.bindPopup(`<strong>${ha(g.name)}</strong><br>${ha(me)}<br>${ha(Ma(g.last_seen_seconds_ago))}`),we.addTo(Be),c.push([D,ne])}if(n){const g=De.circleMarker([n.lat,n.lng],{radius:8,color:"#b36a00",weight:2,fillColor:"#f59e0b",fillOpacity:.85});g.bindPopup(`<strong>Destination</strong><br>${e(P)?.destination?.name??"Retreat destination"}`),g.addTo(Be),c.push([n.lat,n.lng])}const S=sa===0;if(sa=a.length,!c.length){Ae||(e(M).setView([35.1495,-90.049],5),Ae=!0);return}if(c.length===1){(!Ae||S)&&(e(M).setView(c[0],11),Ae=!0);return}(!Ae||S)&&(e(M).fitBounds(c,{padding:[32,32],maxZoom:12}),Ae=!0)}async function kt(a){if(!e(k)||!e(X)||Oa||!e(ee))return;const n=Date.now();if(!(n-Ya<25e3)){Oa=!0;try{const c=a.coords;await fe("/location",{method:"POST",body:JSON.stringify({latitude:c.latitude,longitude:c.longitude,accuracy:Number.isFinite(c.accuracy)?c.accuracy:null,speed:c.speed!==null&&Number.isFinite(c.speed)&&c.speed>=0?c.speed:null,heading:c.heading!==null&&Number.isFinite(c.heading)?c.heading:null,altitude:c.altitude!==null&&Number.isFinite(c.altitude)?c.altitude:null,recorded_at:new Date(a.timestamp).toISOString()})},e(k)),Ya=n,t(z,e(z).map(S=>S.is_current_user?{...S,location:{lat:c.latitude,lng:c.longitude,accuracy:Number.isFinite(c.accuracy)?c.accuracy:null,speed:c.speed!==null&&Number.isFinite(c.speed)&&c.speed>=0?c.speed:null,heading:c.heading!==null&&Number.isFinite(c.heading)?c.heading:null,recorded_at:new Date(a.timestamp).toISOString()},last_seen_seconds_ago:0}:S))}catch{}finally{Oa=!1}}}function Ta(){typeof navigator>"u"||navigator.geolocation&&da!==null&&(navigator.geolocation.clearWatch(da),da=null)}function Tt(){typeof navigator>"u"||navigator.geolocation&&(!e(y)||!e(k)||!e(ee)||da===null&&(da=navigator.geolocation.watchPosition(a=>{kt(a)},a=>{a.code===a.PERMISSION_DENIED&&!La&&(_e("Location permission is disabled. Enable it to share live map markers."),La=!0)},{enableHighAccuracy:!0,maximumAge:15e3,timeout:15e3})))}function ke(a){t(va,a),setTimeout(()=>{e(va)===a&&t(va,"")},2600)}function _e(a){t(la,a),setTimeout(()=>{e(la)===a&&t(la,"")},4200)}async function Nt(){t(E,!0),t(la,"");try{const a=await fe("/join",{method:"POST",body:JSON.stringify({code:za(e(xe)),name:e(ce).trim(),phone_number:e(Ce).trim(),vehicle_color:e(Ne).trim()||null,vehicle_description:e(re).trim()||null})});t(k,a.data.device_token),localStorage.setItem(h,e(k)),await Qa(e(k)),ke("Joined convoy successfully.")}catch(a){_e(a instanceof Error?a.message:"Unable to join retreat.")}finally{t(E,!1)}}async function Qa(a){{const[n,c,S,g]=await Promise.all([fe("/status",{},a),fe("/locations",{},a),fe("/waypoints",{},a),fe("/messages?limit=100",{},a)]);t(V,n.data.participant),t(P,n.data.retreat),t(z,c.data),t(Ie,[...S.data].sort((ne,le)=>ne.order-le.order)),t(Ke,g.data);const D=e(z).find(ne=>ne.is_current_user);t(ee,D?.location_sharing_enabled??n.data.participant.location_sharing_enabled??!0),D&&(t(Ge,D.vehicle_color??e(Ge)),t(Xe,D.vehicle_description??e(Xe))),t(y,!0),Ae=!1,sa=0,t(_,!0)}}async function Je(){if(!(!e(k)||!e(y))){t(ie,!0);try{const[a,n,c]=await Promise.all([fe("/locations",{},e(k)),fe("/waypoints",{},e(k)),fe("/messages?limit=100",{},e(k))]);t(z,a.data),t(Ie,[...n.data].sort((g,D)=>g.order-D.order)),t(Ke,c.data);const S=e(z).find(g=>g.is_current_user);S&&(t(ee,S.location_sharing_enabled??e(ee)),t(Ge,S.vehicle_color??e(Ge)),t(Xe,S.vehicle_description??e(Xe)))}catch(a){_e(a instanceof Error?a.message:"Unable to refresh retreat data.")}finally{t(ie,!1)}}}function Ga(a,n){t(Pe,[...e(Pe),{id:`${Date.now()}-${Math.random().toString(16).slice(2,8)}`,content:a,mode:n,createdAt:Date.now()}]),t(Ue,`${e(Pe).length} message${e(Pe).length===1?"":"s"} queued while offline.`)}async function Pt(){const a=e(Ze).trim();if(a){if(!e(X)){Ga(a,e(d)),t(Ze,"");return}await Xa(a,e(d)),t(Ze,"")}}async function Xa(a,n){const c=e(z).find(g=>g.is_current_user),S={content:n==="prayer"?`üôè Prayer Request: ${a}`:a,message_type:"chat",latitude:c?.location?.lat,longitude:c?.location?.lng};try{await fe("/messages",{method:"POST",body:JSON.stringify(S)},e(k)),await Je(),ke(n==="prayer"?"Prayer request sent.":"Message sent.")}catch(g){const D=g instanceof Error?g.message:"Unable to send message.";_e(D),Ga(a,n)}}async function et(){if(!e(Pe).length||!e(X))return;const a=[...e(Pe)];t(Pe,[]);for(const n of a)await Xa(n.content,n.mode);t(Ue,"Queued messages flushed."),setTimeout(()=>{e(Ue)==="Queued messages flushed."&&t(Ue,"")},2500)}async function Dt(){if(!e(b)){_e("Only retreat leaders can send emergency alerts.");return}const a=e(Qe).trim();if(!a){_e("Please enter the emergency message before sending.");return}try{await fe("/messages",{method:"POST",body:JSON.stringify({message_type:"alert",content:`[${e(Ee).toUpperCase()}] ${a}`})},e(k)),ke(`Emergency alert sent (${e(Ee)}).`),t(Qe,""),t(ua,!1),t(H,"chat"),await Je()}catch(n){_e(n instanceof Error?n.message:"Unable to send emergency alert.")}}function At(a){if(e(H)!=="map"&&t(H,"map"),!ka(a.location?.lat,a.location?.lng)){_e(`${a.name} does not have a live location yet.`);return}const n=Number(a.location.lat),c=Number(a.location.lng),S=Ia(a),g=()=>{if(!e(M))return;const D=typeof e(M).getZoom=="function"?Math.max(13,Number(e(M).getZoom()??13)):13;e(M).setView([n,c],D,{animate:!0}),De?.popup&&De.popup({closeButton:!1,offset:[0,-10]}).setLatLng([n,c]).setContent(`<strong>${ha(a.name)}</strong><br>${ha(S)}`).openOn(e(M))};if(!e(M)){Ka().then(()=>{g()});return}g()}function Lt(){t(j,null)}function Ot(a){t(H,"chat"),t(d,"chat"),t(Ze,`@${a.name} `),t(j,null)}function Mt(a){t(H,"chat"),t(d,"prayer"),t(Ze,`Praying for ${a.name} ‚Äî `),t(j,null)}function It(a){t(H,"alert"),t(Ee,"high"),t(Qe,`Need leader support near ${a.name}: `),t(j,null)}function Rt(a){ke("Call shortcut wired. Number binding comes next.")}async function Ft(a){if(a&&e(k)){t(he,!0);try{const n=await Ut(a);await fe("/profile-photo",{method:"POST",body:JSON.stringify({avatar_base64:n})},e(k)),ke("Profile photo updated."),await Je()}catch(n){_e(n instanceof Error?n.message:"Could not upload profile photo.")}finally{t(he,!1)}}}async function qt(){if(e(k)){t(he,!0);try{await fe("/profile-photo",{method:"DELETE"},e(k)),ke("Profile photo removed."),await Je()}catch(a){_e(a instanceof Error?a.message:"Could not remove profile photo.")}finally{t(he,!1)}}}async function $t(a){if(e(k)&&!e(fa)&&a!==e(ee)){t(fa,!0);try{const n=await fe("/location-sharing",{method:"POST",body:JSON.stringify({enabled:a})},e(k));t(ee,n.data.location_sharing_enabled),e(V)&&t(V,{...e(V),location_sharing_enabled:e(ee)}),t(z,e(z).map(c=>c.is_current_user?{...c,location_sharing_enabled:e(ee),location:e(ee)?c.location:null}:c)),e(ee)?(La=!1,ke("Location sharing re-enabled.")):(Ta(),ke("Location sharing paused. Your marker is hidden from the map.")),await Je()}catch(n){_e(n instanceof Error?n.message:"Could not update location sharing.")}finally{t(fa,!1)}}}function at(){localStorage.removeItem(h),t(y,!1),t(k,""),t(V,null),t(P,null),t(z,[]),t(Ie,[]),t(Ke,[]),t(Pe,[]),t(ee,!0),Ta(),e(M)&&(e(M).remove(),t(M,null),Be=null),Ae=!1,sa=0}async function Ht(){if(e(k)){t($,!0);try{await fe("/leave",{method:"POST"},e(k)),at(),ke("You have left the retreat.")}catch(a){_e(a instanceof Error?a.message:"Could not leave retreat.")}finally{t($,!1)}}}async function Vt(){if(!(!e(k)||e(Y)||!(typeof window<"u"&&window.confirm("Delete your account and retreat data now? This cannot be undone.")))){t(Y,!0);try{await fe("/account",{method:"DELETE",body:JSON.stringify({confirm_delete:!0})},e(k)),at(),ke("Your account and retreat data were deleted.")}catch(n){_e(n instanceof Error?n.message:"Could not delete account data.")}finally{t(Y,!1)}}}async function jt(){if(!e(X)){_e("Still offline. Messages remain queued.");return}await et()}function Ut(a){return new Promise((n,c)=>{const S=new FileReader;S.onload=()=>n(String(S.result)),S.onerror=()=>c(new Error("Failed to read file")),S.readAsDataURL(a)})}function Bt(){const a=new Date().toISOString(),n=Date.now();t(V,{id:101,name:"Chris Hogg",phone_display:"+1‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢5761",is_leader:!0,location_sharing_enabled:!0,avatar_url:null}),t(P,{id:501,name:"Spring Retreat Convoy",destination:{name:"Branson Camp Grounds",lat:36.6406,lng:-93.2185},starts_at:new Date(n-3600*1e3).toISOString(),ends_at:new Date(n+1080*60*1e3).toISOString(),participant_count:4}),t(z,[{participant_id:101,name:"Chris Hogg",gender:null,avatar_url:null,vehicle_color:"Silver",vehicle_description:"Ford F-150",is_leader:!0,is_current_user:!0,location_sharing_enabled:!0,location:{lat:36.612,lng:-93.287,accuracy:9,speed:17,heading:112,recorded_at:a,place:{label:"At Trumann Community Health Club",name:"Trumann Community Health Club",relation:"at",distance_m:12,confidence:"high",source:"nominatim"}},last_seen_seconds_ago:5},{participant_id:102,name:"Sarah Jenkins",gender:null,avatar_url:null,vehicle_color:"White",vehicle_description:"Honda CR-V",is_leader:!1,is_current_user:!1,location_sharing_enabled:!0,location:{lat:36.618,lng:-93.272,accuracy:13,speed:18,heading:108,recorded_at:a},last_seen_seconds_ago:28},{participant_id:103,name:"Micah Davis",gender:null,avatar_url:null,vehicle_color:"Blue",vehicle_description:"Chevy Traverse",is_leader:!1,is_current_user:!1,location_sharing_enabled:!0,location:{lat:36.604,lng:-93.248,accuracy:11,speed:21,heading:96,recorded_at:a},last_seen_seconds_ago:13},{participant_id:104,name:"Linda Perez",gender:null,avatar_url:null,vehicle_color:"Black",vehicle_description:"Kia Telluride",is_leader:!1,is_current_user:!1,location_sharing_enabled:!0,location:{lat:36.597,lng:-93.214,accuracy:14,speed:16,heading:92,recorded_at:a},last_seen_seconds_ago:36}]),t(Ie,[{id:1,name:"Fuel + regroup",description:"Top off and verify all vans are accounted for.",lat:36.621,lng:-93.295,order:1,eta:new Date(n+1500*1e3).toISOString()},{id:2,name:"Prayer circle",description:"10-minute devotion and route update.",lat:36.634,lng:-93.252,order:2,eta:new Date(n+3300*1e3).toISOString()},{id:3,name:"Arrive at retreat camp",description:"Unload and check in by group name.",lat:36.641,lng:-93.219,order:3,eta:new Date(n+5400*1e3).toISOString()}]),t(Ke,[{id:1,message_type:"chat",content:"All vehicles are rolling. Next checkpoint in ~25 minutes.",sender:{id:101,name:"Chris Hogg",is_leader:!0,gender:null,avatar_url:null},location:null,created_at:new Date(n-480*1e3).toISOString()},{id:2,message_type:"chat",content:"üôè Prayer Request: please pray for safe travel and calm weather.",sender:{id:102,name:"Sarah Jenkins",is_leader:!1,gender:null,avatar_url:null},location:null,created_at:new Date(n-240*1e3).toISOString()},{id:3,message_type:"alert",content:"[HIGH] Keep hazard lights on for reduced visibility zone ahead.",sender:{id:101,name:"Chris Hogg",is_leader:!0,gender:null,avatar_url:null},location:null,created_at:new Date(n-120*1e3).toISOString()}]),t(Ge,"Silver"),t(Xe,"Ford F-150"),t(y,!0),t(_,!0),t(Ue,"Demo mode active from ?demo=1 for visual sharing.")}or(()=>{t(X,navigator.onLine);const a=localStorage.getItem(N);(a==="day"||a==="night")&&t(p,a),(async()=>{if(new URLSearchParams(window.location.search).get("demo")==="1"){Bt();return}const D=localStorage.getItem(h);if(D){t(k,D);try{await Qa(D)}catch{localStorage.removeItem(h),t(k,""),t(_,!0)}}else t(_,!0)})();const n=async()=>{t(X,!0),await et(),await Je()},c=()=>{t(X,!1),t(Ue,"You are offline. New messages will be queued.")};return window.addEventListener("online",n),window.addEventListener("offline",c),Aa=setInterval(()=>{e(y)&&e(X)&&Je()},2e4),()=>{window.removeEventListener("online",n),window.removeEventListener("offline",c),Aa&&clearInterval(Aa),Ta(),e(M)&&(e(M).remove(),t(M,null),Be=null)}}),Ye(()=>e(z),()=>{t(u,e(z).filter(a=>(a.last_seen_seconds_ago??9999)<300).length)}),Ye(()=>e(z),()=>{t(i,Et(e(z)))}),Ye(()=>e(V),()=>{t(b,e(V)?.is_leader===!0)}),Ye(()=>e(Pe),()=>{t(f,e(Pe).length)}),Ye(()=>e(p),()=>{e(p)==="night"&&typeof document<"u"?document.body.classList.add("theme-night"):typeof document<"u"&&document.body.classList.remove("theme-night")}),Ye(()=>(e(y),e(H),e(ea)),()=>{e(y)&&e(H)==="map"&&e(ea)&&Ka()}),Ye(()=>(e(M),e(y),e(H)),()=>{e(M)&&e(y)&&e(H)==="map"&&Za()}),Ye(()=>(e(y),e(k),e(ee)),()=>{e(y)&&e(k)&&e(ee)?Tt():Ta()}),Or(),sr();var tt=yn(),rt=vt(tt);{var Jt=a=>{var n=Br();C(a,n)},Yt=a=>{var n=Jr(),c=s(n),S=o(s(c),2),g=s(S),D=o(s(g));$e(D),l(g);var ne=o(g,2),le=o(s(ne));$e(le),l(ne);var we=o(ne,2),me=o(s(we));$e(me),l(we);var Le=o(we,2),be=s(Le),Re=o(s(be));$e(Re),l(be);var Oe=o(be,2),aa=o(s(Oe));$e(aa),l(Oe),l(Le);var Fe=o(Le,2),oa=s(Fe,!0);l(Fe),l(S);var ia=o(S,4),Te=s(ia),ta=s(Te,!0);l(Te),l(ia),l(c),l(n),Z(()=>{Fe.disabled=e(E),w(oa,e(E)?"Joining‚Ä¶":"Start the Journey"),w(ta,e(p)==="day"?"üåô Night mode":"‚òÄÔ∏è Day mode")}),He(D,()=>e(xe),ue=>t(xe,ue)),F("input",D,ue=>{const pa=ue.currentTarget;t(xe,za(pa.value))}),He(le,()=>e(ce),ue=>t(ce,ue)),He(me,()=>e(Ce),ue=>t(Ce,ue)),He(Re,()=>e(Ne),ue=>t(Ne,ue)),He(aa,()=>e(re),ue=>t(re,ue)),F("submit",S,Vr(Nt)),F("click",Te,()=>{t(p,e(p)==="day"?"night":"day"),localStorage.setItem(N,e(p))}),C(a,n)},zt=a=>{var n=fn(),c=s(n),S=s(c),g=s(S),D=s(g,!0);l(g);var ne=o(g,4),le=s(ne);l(ne),l(S);var we=o(S,2),me=s(we),Le=s(me,!0);l(me);var be=o(me,2),Re=s(be,!0);l(be),l(we),l(c);var Oe=o(c,2);{var aa=J=>{var T=Yr(),L=s(T),Q=s(L),se=s(Q,!0);l(Q);var q=o(Q,2),U=s(q);{var ae=I=>{var O=wa();Z(()=>w(O,`${e(f)??""} queued message${e(f)===1?"":"s"} waiting to send.`)),C(I,O)},B=I=>{var O=wa("You can keep using the app ‚Äî new messages will sync when your signal returns.");C(I,O)};oe(U,I=>{e(X)?I(ae):I(B,!1)})}l(q),l(L);var ve=o(L,2);l(T),Z(()=>w(se,e(X)?"Queued updates ready":"Offline mode active")),F("click",ve,jt),C(J,T)};oe(Oe,J=>{(!e(X)||e(f)>0)&&J(aa)})}var Fe=o(Oe,2);xa(Fe,5,()=>St,Sa,(J,T)=>{var L=zr();let Q;var se=s(L),q=s(se,!0);l(se);var U=o(se,2),ae=s(U,!0);l(U),l(L),Z(()=>{Q=We(L,1,"svelte-1uha8ag",null,Q,{active:e(H)===e(T).id}),w(q,(e(T),x(()=>e(T).icon))),w(ae,(e(T),x(()=>e(T).label)))}),F("click",L,()=>t(H,e(T).id)),C(J,L)}),l(Fe);var oa=o(Fe,2);{var ia=J=>{var T=Zr(),L=s(T),Q=o(s(L),2),se=s(Q,!0);l(Q),l(L);var q=o(L,2),U=s(q);nr(U,I=>t(ea,I),()=>e(ea));var ae=o(U,2);{var B=I=>{var O=Wr();C(I,O)};oe(ae,I=>{e(i),x(()=>e(i).length===0)&&I(B)})}l(q);var ve=o(q,4);xa(ve,5,()=>e(z),Sa,(I,O)=>{var te=Kr(),ye=s(te),Se=s(ye,!0);l(ye);var de=o(ye,2),R=s(de),W=s(R,!0);l(R);var pe=o(R,2),qe=s(pe,!0);l(pe),l(de);var G=o(de,2),Me=s(G,!0);l(G),l(te),Z((ra,na)=>{w(Se,(e(O),x(()=>e(O).is_leader?"‚≠ê":"üë§"))),w(W,(e(O),x(()=>e(O).name))),w(qe,ra),w(Me,na)},[()=>(e(O),x(()=>Ia(e(O)))),()=>(e(O),x(()=>Ma(e(O).last_seen_seconds_ago)))]),F("click",te,()=>At(e(O))),C(I,te)}),l(ve),l(T),Z(()=>w(se,(e(P),x(()=>e(P)?.destination?.name?`Destination: ${e(P).destination.name}`:"Destination syncing‚Ä¶")))),C(J,T)},Te=J=>{var T=en(),L=o(s(T),2);{var Q=q=>{var U=Qr();C(q,U)},se=q=>{var U=Xr();xa(U,5,()=>e(Ie),Sa,(ae,B,ve)=>{var I=Gr(),O=s(I),te=o(O,2),ye=s(te);ye.textContent=`Stop ${ve+1}`;var Se=o(ye,2),de=s(Se,!0);l(Se);var R=o(Se,2),W=s(R,!0);l(R);var pe=o(R,2),qe=s(pe);l(pe),l(te),l(I),Z((G,Me)=>{We(O,1,`timeline-dot ${G??""}`,"svelte-1uha8ag"),w(de,(e(B),x(()=>e(B).name))),w(W,(e(B),x(()=>e(B).description??"No additional note."))),w(qe,`ETA ${Me??""}`)},[()=>(e(B),x(()=>new Date(e(B).eta??"").getTime()<Date.now()?"done":"")),()=>(e(B),x(()=>Wa(e(B).eta)))]),C(ae,I)}),l(U),C(q,U)};oe(L,q=>{e(Ie),x(()=>e(Ie).length===0)?q(Q):q(se,!1)})}l(T),C(J,T)},ta=J=>{var T=nn(),L=o(s(T),2),Q=s(L);{var se=R=>{var W=an();C(R,W)},q=R=>{var W=lr(),pe=vt(W);xa(pe,1,()=>e(Ke),Sa,(qe,G)=>{var Me=tn(),ra=s(Me),na=s(ra),Ra=s(na,!0);l(na);var ga=o(na,2),_a=s(ga,!0);l(ga),l(ra);var ma=o(ra,2),Na=s(ma,!0);l(ma),l(Me),Z(ba=>{We(Me,1,(e(G),x(()=>`chat-item ${e(G).message_type==="alert"?"alert":""}`)),"svelte-1uha8ag"),w(Ra,(e(G),x(()=>e(G).sender.name))),w(_a,ba),w(Na,(e(G),x(()=>e(G).content)))},[()=>(e(G),x(()=>Wa(e(G).created_at)))]),C(qe,Me)}),C(R,W)};oe(Q,R=>{e(Ke),x(()=>e(Ke).length===0)?R(se):R(q,!1)})}l(L);var U=o(L,2),ae=s(U),B=s(ae);let ve;var I=o(B,2);let O;l(ae);var te=o(ae,2);ft(te);var ye=o(te,2),Se=o(ye,2);{var de=R=>{var W=rn(),pe=s(W,!0);l(W),Z(()=>w(pe,e(Ue))),C(R,W)};oe(Se,R=>{e(Ue)&&R(de)})}l(U),l(T),Z(()=>{ve=We(B,1,"svelte-1uha8ag",null,ve,{active:e(d)==="chat"}),O=We(I,1,"svelte-1uha8ag",null,O,{active:e(d)==="prayer"}),ht(te,"placeholder",e(d)==="prayer"?"Share a prayer need for the caravan‚Ä¶":"Send a convoy update‚Ä¶")}),F("click",B,()=>t(d,"chat")),F("click",I,()=>t(d,"prayer")),He(te,()=>e(Ze),R=>t(Ze,R)),F("click",ye,Pt),C(J,T)},ue=J=>{var T=cn(),L=o(s(T),2);{var Q=q=>{var U=ln();C(q,U)},se=q=>{var U=on(),ae=s(U);xa(ae,4,()=>["low","medium","high","critical"],Sa,(de,R)=>{var W=sn();let pe;var qe=s(W,!0);l(W),Z(()=>{pe=We(W,1,"svelte-1uha8ag",null,pe,{active:e(Ee)===R}),w(qe,R)}),F("click",W,()=>t(Ee,R)),C(de,W)}),l(ae);var B=o(ae,2);ft(B);var ve=o(B,2),I=o(s(ve),2),O=s(I),te=s(O);l(O);var ye=o(O);l(I),l(ve);var Se=o(ve,2);l(U),Z(de=>{w(te,`[${de??""}]`),w(ye,` ${(e(Qe)||"No message yet.")??""}`)},[()=>(e(Ee),x(()=>e(Ee).toUpperCase()))]),He(B,()=>e(Qe),de=>t(Qe,de)),F("click",Se,()=>t(ua,!0)),C(q,U)};oe(L,q=>{e(b)?q(se,!1):q(Q)})}l(T),C(J,T)},pa=J=>{var T=dn(),L=o(s(T),2),Q=s(L),se=s(Q);{var q=K=>{var ge=un();Z(()=>ht(ge,"src",(e(V),x(()=>e(V).avatar_url)))),C(K,ge)},U=K=>{var ge=vn(),ar=s(ge,!0);l(ge),Z(tr=>w(ar,tr),[()=>(e(V),x(()=>e(V)?.name?.slice(0,1)??"C"))]),C(K,ge)};oe(se,K=>{e(V),x(()=>e(V)?.avatar_url)?K(q):K(U,!1)})}l(Q);var ae=o(Q,2),B=s(ae),ve=o(s(B));$e(ve),l(B);var I=o(B,2),O=o(s(I));$e(O),l(I);var te=o(I,2),ye=o(s(te));$e(ye),l(te);var Se=o(te,2),de=o(s(Se));$e(de),l(Se),l(ae),l(L);var R=o(L,2),W=s(R),pe=o(s(W),2),qe=s(pe);l(pe),dt(2),l(W);var G=o(W,2),Me=s(G);{var ra=K=>{var ge=wa("Saving‚Ä¶");C(K,ge)},na=K=>{var ge=wa("Unshare my location");C(K,ge)},Ra=K=>{var ge=wa("Share my location again");C(K,ge)};oe(Me,K=>{e(fa)?K(ra):e(ee)?K(na,1):K(Ra,!1)})}l(G),l(R);var ga=o(R,2),_a=s(ga),ma=s(_a),Na=o(ma);l(_a);var ba=o(_a,2),ot=o(ba,2),ya=o(ot,2),Xt=s(ya,!0);l(ya);var Pa=o(ya,2),er=s(Pa,!0);l(Pa),l(ga),l(T),Z(()=>{pt(ve,(e(V),x(()=>e(V)?.name??""))),pt(O,(e(V),x(()=>e(V)?.phone_display??""))),w(qe,`Location sharing is ${e(ee)?"On":"Off"}`),We(G,1,$r(e(ee)?"danger-outline":"ghost"),"svelte-1uha8ag"),G.disabled=e(fa),w(ma,`${e(he)?"Uploading‚Ä¶":"Upload profile photo"} `),Na.disabled=e(he),ba.disabled=e(he),ya.disabled=e($)||e(Y),w(Xt,e($)?"Leaving‚Ä¶":"Leave retreat"),Pa.disabled=e($)||e(Y),w(er,e(Y)?"Deleting‚Ä¶":"Delete account & data")}),He(ye,()=>e(Ge),K=>t(Ge,K)),He(de,()=>e(Xe),K=>t(Xe,K)),F("click",G,()=>$t(!e(ee))),F("change",Na,K=>{const ge=K.currentTarget;Ft(ge.files?.[0]??null),ge.value=""}),F("click",ba,qt),F("click",ot,()=>ke("Vehicle detail save endpoint is next backend step.")),F("click",ya,Ht),F("click",Pa,Vt),C(J,T)};oe(oa,J=>{e(H)==="map"?J(ia):e(H)==="waypoints"?J(Te,1):e(H)==="chat"?J(ta,2):e(H)==="alert"?J(ue,3):e(H)==="profile"&&J(pa,4)})}l(n),Z(()=>{We(n,1,`app-shell ${e(p)==="night"?"night":""}`,"svelte-1uha8ag"),w(D,(e(P),x(()=>e(P)?.name??"Calvary Caravan"))),w(le,`${e(u)??""}/${e(z),x(()=>e(z).length)??""} online ¬∑ ${e(P),e(z),x(()=>e(P)?.participant_count??e(z).length)??""} total`),w(Le,e(p)==="day"?"üåô":"‚òÄÔ∏è"),be.disabled=e(ie),w(Re,e(ie)?"‚Ä¶":"‚Üª")}),F("click",me,()=>{t(p,e(p)==="day"?"night":"day"),localStorage.setItem(N,e(p))}),F("click",be,Je),C(a,n)};oe(rt,a=>{e(_)?e(y)?a(zt,!1):a(Yt,1):a(Jt)})}var nt=o(rt,2);{var Wt=a=>{var n=gn(),c=s(n),S=o(c,2),g=s(S),D=s(g),ne=s(D,!0);l(D);var le=o(D,2),we=s(le);l(le);var me=o(le,2);{var Le=Te=>{var ta=pn(),ue=s(ta),pa=o(ue);{var J=T=>{var L=hn(),Q=s(L);l(L),Z(se=>w(Q,`(${se??""})`),[()=>(e(j),x(()=>xt(e(j).location.place.distance_m)))]),C(T,L)};oe(pa,T=>{e(j),x(()=>e(j).location.place.distance_m!==null)&&T(J)})}l(ta),Z(()=>w(ue,`üìç ${e(j),x(()=>e(j).location.place.label)??""} `)),C(Te,ta)};oe(me,Te=>{e(j),x(()=>e(j).location?.place?.label)&&Te(Le)})}l(g);var be=o(g,2),Re=s(be),Oe=o(Re,2),aa=o(Oe,2),Fe=o(aa,2);l(be);var oa=o(be,2),ia=s(oa);l(oa),l(S),l(n),Z(Te=>{w(ne,(e(j),x(()=>e(j).name))),w(we,`${e(j),x(()=>e(j).vehicle_color??"Vehicle TBD")??""} ¬∑ ${e(j),x(()=>e(j).vehicle_description??"Description TBD")??""}`),w(ia,`Last seen: ${Te??""}`)},[()=>(e(j),x(()=>Ma(e(j).last_seen_seconds_ago)))]),F("click",c,Lt),F("click",Re,()=>Rt(e(j))),F("click",Oe,()=>Ot(e(j))),F("click",aa,()=>Mt(e(j))),F("click",Fe,()=>It(e(j))),C(a,n)};oe(nt,a=>{e(j)&&a(Wt)})}var lt=o(nt,2);{var Kt=a=>{var n=_n(),c=s(n),S=o(c,2),g=o(s(S),2),D=o(s(g)),ne=s(D,!0);l(D),dt(),l(g);var le=o(g,2),we=s(le);l(le);var me=o(le,2),Le=s(me),be=o(Le,2);l(me),l(S),l(n),Z((Re,Oe)=>{w(ne,Re),w(we,`[${Oe??""}] ${(e(Qe)||"No message entered.")??""}`)},[()=>(e(Ee),x(()=>e(Ee).toUpperCase())),()=>(e(Ee),x(()=>e(Ee).toUpperCase()))]),F("click",c,()=>t(ua,!1)),F("click",Le,()=>t(ua,!1)),F("click",be,Dt),C(a,n)};oe(lt,a=>{e(ua)&&a(Kt)})}var st=o(lt,2);{var Zt=a=>{var n=mn(),c=s(n);l(n),Z(()=>w(c,`‚ö†Ô∏è ${e(la)??""}`)),C(a,n)};oe(st,a=>{e(la)&&a(Zt)})}var Qt=o(st,2);{var Gt=a=>{var n=bn(),c=s(n);l(n),Z(()=>w(c,`‚úÖ ${e(va)??""}`)),C(a,n)};oe(Qt,a=>{e(va)&&a(Gt)})}C(r,tt),Mr()}export{Nn as component};
