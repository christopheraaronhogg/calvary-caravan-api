import{i as oe,_ as zt,b as Yt}from"../chunks/DOj_L230.js";import{a as C,f as N,t as ga,c as Wt}from"../chunks/Cqtqrt0G.js";import{i as Kt}from"../chunks/BTI8y7Wc.js";import{o as Qt}from"../chunks/-eHITvjr.js";import{h as Le,P as Na,X as Gt,e as Ma,H as Xt,G as Zt,t as e,J as er,M as ar,O as Za,Q as Aa,i as xa,V as tr,ax as rr,ah as et,c as la,f as Ra,aR as nr,s as lr,aJ as sr,aS as ir,av as qa,aT as or,a5 as at,aU as cr,aV as ur,aN as b,aW as Ie,r as ot,p as ct,aX as Oa,aY as vr,au as dr,d as fr,W as hr,aZ as ut,q as gr,a_ as pr,a$ as _r,aO as mr,l as x,S as br,b0 as yr,z as wr,b1 as Ue,b2 as Sr,A as tt,C as Cr,aD as r,F as i,D as s,E as l,B as W,ai as rt,b3 as nt}from"../chunks/B9mbK8lt.js";import{s as w,e as q}from"../chunks/AFsuBYVU.js";import{r as Xe,s as lt,a as xr}from"../chunks/DDxyQvBn.js";function pa(t,d){return d}function Er(t,d,u){for(var o=[],_=d.length,f,h=d.length,T=0;T<_;T++){let ce=d[T];ct(ce,()=>{if(f){if(f.pending.delete(ce),f.done.add(ce),f.pending.size===0){var V=t.outrogroups;Fa(qa(f.done)),V.delete(f),V.size===0&&(t.outrogroups=null)}}else h-=1},!1)}if(h===0){var g=o.length===0&&u!==null;if(g){var m=u,E=m.parentNode;dr(E),E.append(m),t.items.clear()}Fa(d,!g)}else f={pending:new Set(d),done:new Set},(t.outrogroups??=new Set).add(f)}function Fa(t,d=!0){for(var u=0;u<t.length;u++)fr(t[u],d)}var st;function _a(t,d,u,o,_,f=null){var h=t,T=new Map,g=(d&ut)!==0;if(g){var m=t;h=Le?Na(Gt(m)):m.appendChild(Ma())}Le&&Xt();var E=null,ce=sr(()=>{var p=u();return ir(p)?p:p==null?[]:qa(p)}),V,J=!0;function $(){v.fallback=E,kr(v,V,h,d,o),E!==null&&(V.length===0?(E.f&Ie)===0?ot(E):(E.f^=Ie,ba(E,null,h)):ct(E,()=>{E=null}))}var ue=Zt(()=>{V=e(ce);var p=V.length;let Ce=!1;if(Le){var Te=er(h)===ar;Te!==(p===0)&&(h=Za(),Na(h),Aa(!1),Ce=!0)}for(var ve=new Set,xe=la,P=lr(),D=0;D<p;D+=1){Le&&xa.nodeType===tr&&xa.data===rr&&(h=xa,Ce=!0,Aa(!1));var K=V[D],L=o(K,D),U=J?null:T.get(L);U?(U.v&&et(U.v,K),U.i&&et(U.i,D),P&&xe.unskip_effect(U.e)):(U=Tr(T,J?h:st??=Ma(),K,L,D,_,d,u),J||(U.e.f|=Ie),T.set(L,U)),ve.add(L)}if(p===0&&f&&!E&&(J?E=Ra(()=>f(h)):(E=Ra(()=>f(st??=Ma())),E.f|=Ie)),p>ve.size&&nr(),Le&&p>0&&Na(Za()),!J)if(P){for(const[De,ye]of T)ve.has(De)||xe.skip_effect(ye.e);xe.oncommit($),xe.ondiscard(()=>{})}else $();Ce&&Aa(!0),e(ce)}),v={effect:ue,items:T,outrogroups:null,fallback:E};J=!1,Le&&(h=xa)}function ma(t){for(;t!==null&&(t.f&vr)===0;)t=t.next;return t}function kr(t,d,u,o,_){var f=(o&pr)!==0,h=d.length,T=t.items,g=ma(t.effect.first),m,E=null,ce,V=[],J=[],$,ue,v,p;if(f)for(p=0;p<h;p+=1)$=d[p],ue=_($,p),v=T.get(ue).e,(v.f&Ie)===0&&(v.nodes?.a?.measure(),(ce??=new Set).add(v));for(p=0;p<h;p+=1){if($=d[p],ue=_($,p),v=T.get(ue).e,t.outrogroups!==null)for(const U of t.outrogroups)U.pending.delete(v),U.done.delete(v);if((v.f&Ie)!==0)if(v.f^=Ie,v===g)ba(v,null,u);else{var Ce=E?E.next:g;v===t.effect.last&&(t.effect.last=v.prev),v.prev&&(v.prev.next=v.next),v.next&&(v.next.prev=v.prev),je(t,E,v),je(t,v,Ce),ba(v,Ce,u),E=v,V=[],J=[],g=ma(E.next);continue}if((v.f&Oa)!==0&&(ot(v),f&&(v.nodes?.a?.unfix(),(ce??=new Set).delete(v))),v!==g){if(m!==void 0&&m.has(v)){if(V.length<J.length){var Te=J[0],ve;E=Te.prev;var xe=V[0],P=V[V.length-1];for(ve=0;ve<V.length;ve+=1)ba(V[ve],Te,u);for(ve=0;ve<J.length;ve+=1)m.delete(J[ve]);je(t,xe.prev,P.next),je(t,E,xe),je(t,P,Te),g=Te,E=P,p-=1,V=[],J=[]}else m.delete(v),ba(v,g,u),je(t,v.prev,v.next),je(t,v,E===null?t.effect.first:E.next),je(t,E,v),E=v;continue}for(V=[],J=[];g!==null&&g!==v;)(m??=new Set).add(g),J.push(g),g=ma(g.next);if(g===null)continue}(v.f&Ie)===0&&V.push(v),E=v,g=ma(v.next)}if(t.outrogroups!==null){for(const U of t.outrogroups)U.pending.size===0&&(Fa(qa(U.done)),t.outrogroups?.delete(U));t.outrogroups.size===0&&(t.outrogroups=null)}if(g!==null||m!==void 0){var D=[];if(m!==void 0)for(v of m)(v.f&Oa)===0&&D.push(v);for(;g!==null;)(g.f&Oa)===0&&g!==t.fallback&&D.push(g),g=ma(g.next);var K=D.length;if(K>0){var L=(o&ut)!==0&&h===0?u:null;if(f){for(p=0;p<K;p+=1)D[p].nodes?.a?.measure();for(p=0;p<K;p+=1)D[p].nodes?.a?.fix()}Er(t,D,L)}}f&&gr(()=>{if(ce!==void 0)for(v of ce)v.nodes?.a?.apply()})}function Tr(t,d,u,o,_,f,h,T){var g=(h&cr)!==0?(h&ur)===0?b(u,!1,!1):at(u):null,m=(h&or)!==0?at(_):null;return{v:g,i:m,e:Ra(()=>(f(d,g??u,m??_,T),()=>{t.delete(o)}))}}function ba(t,d,u){if(t.nodes)for(var o=t.nodes.start,_=t.nodes.end,f=d&&(d.f&Ie)===0?d.nodes.start:u;o!==null;){var h=hr(o);if(f.before(o),o===_)return;o=h}}function je(t,d,u){d===null?t.effect.first=u:d.next=u,u===null?t.effect.last=d:u.prev=d}function vt(t){var d,u,o="";if(typeof t=="string"||typeof t=="number")o+=t;else if(typeof t=="object")if(Array.isArray(t)){var _=t.length;for(d=0;d<_;d++)t[d]&&(u=vt(t[d]))&&(o&&(o+=" "),o+=u)}else for(u in t)t[u]&&(o&&(o+=" "),o+=u);return o}function Pr(){for(var t,d,u=0,o="",_=arguments.length;u<_;u++)(t=arguments[u])&&(d=vt(t))&&(o&&(o+=" "),o+=d);return o}function Dr(t){return typeof t=="object"?Pr(t):t??""}const it=[...` 	
\r\f¬†\v\uFEFF`];function Nr(t,d,u){var o=t==null?"":""+t;if(d&&(o=o?o+" "+d:d),u){for(var _ in u)if(u[_])o=o?o+" "+_:_;else if(o.length)for(var f=_.length,h=0;(h=o.indexOf(_,h))>=0;){var T=h+f;(h===0||it.includes(o[h-1]))&&(T===o.length||it.includes(o[T]))?o=(h===0?"":o.substring(0,h))+o.substring(T+1):h=T}}return o===""?null:o}function Be(t,d,u,o,_,f){var h=t.__className;if(Le||h!==u||h===void 0){var T=Nr(u,o,f);(!Le||T!==t.getAttribute("class"))&&(T==null?t.removeAttribute("class"):t.className=T),t.__className=u}else if(f&&_!==f)for(var g in f){var m=!!f[g];(_==null||m!==!!_[g])&&t.classList.toggle(g,m)}return f}function Je(t,d,u=d){var o=new WeakSet;_r(t,"input",async _=>{var f=_?t.defaultValue:t.value;if(f=La(t)?Ia(f):f,u(f),la!==null&&o.add(la),await mr(),f!==(f=d())){var h=t.selectionStart,T=t.selectionEnd,g=t.value.length;if(t.value=f??"",T!==null){var m=t.value.length;h===T&&T===g&&m>g?(t.selectionStart=m,t.selectionEnd=m):(t.selectionStart=h,t.selectionEnd=Math.min(T,m))}}}),(Le&&t.defaultValue!==t.value||x(d)==null&&t.value)&&(u(La(t)?Ia(t.value):t.value),la!==null&&o.add(la)),br(()=>{var _=d();if(t===document.activeElement){var f=yr??la;if(o.has(f))return}La(t)&&_===Ia(t.value)||t.type==="date"&&!_&&!t.value||_!==t.value&&(t.value=_??"")})}function La(t){var d=t.type;return d==="number"||d==="range"}function Ia(t){return t===""?null:+t}function Mr(t){return function(...d){var u=d[0];return u.preventDefault(),t?.apply(this,d)}}const Ar="/api/v1/retreat";function Or(t,d){if(!t)return`Request failed (${d})`;try{const u=JSON.parse(t);if(u.error)return u.error;if(u.message)return u.message;if(u.errors&&typeof u.errors=="object"){const o=Object.values(u.errors)[0];if(Array.isArray(o)&&o.length>0)return String(o[0]);if(typeof o=="string")return o}}catch{}return t}async function he(t,d={},u){const o=new Headers(d.headers??{});o.set("Accept","application/json"),d.body&&!o.has("Content-Type")&&o.set("Content-Type","application/json"),u&&o.set("X-Device-Token",u);const _=await fetch(`${Ar}${t}`,{...d,headers:o});if(!_.ok){const f=await _.text();throw new Error(Or(f,_.status))}return await _.json()}var Lr=N('<main class="boot-screen svelte-1uha8ag"><h1>Loading Calvary Caravan‚Ä¶</h1> <p>Syncing your convoy workspace.</p></main>'),Ir=N('<main class="join-shell svelte-1uha8ag"><section class="join-card svelte-1uha8ag"><div class="join-header svelte-1uha8ag"><span class="eyebrow svelte-1uha8ag">Calvary Caravan</span> <h1 class="svelte-1uha8ag">Join the Retreat</h1> <p class="svelte-1uha8ag">Enter your retreat code and basic details to sync with your group on the road.</p></div> <form class="join-form svelte-1uha8ag"><label class="svelte-1uha8ag">6-character invite code <input maxlength="6" placeholder="TEST26" required="" class="svelte-1uha8ag"/></label> <label class="svelte-1uha8ag">Full name <input maxlength="50" placeholder="e.g. Sarah Jenkins" required="" class="svelte-1uha8ag"/></label> <div class="split-fields svelte-1uha8ag"><label class="svelte-1uha8ag">Vehicle color <input maxlength="30" placeholder="e.g. Silver" class="svelte-1uha8ag"/></label> <label class="svelte-1uha8ag">Make/model <input maxlength="50" placeholder="e.g. Honda CR-V" class="svelte-1uha8ag"/></label></div> <button type="submit" class="svelte-1uha8ag"> </button></form> <div class="join-footer"><button type="button" class="theme-toggle svelte-1uha8ag"> </button></div></section></main>'),Rr=N('<section class="status-banner card svelte-1uha8ag"><div><strong> </strong> <p class="svelte-1uha8ag"><!></p></div> <button type="button" class="small svelte-1uha8ag">Retry now</button></section>'),Fr=N('<button type="button"><span> </span> <small class="svelte-1uha8ag"> </small></button>'),qr=N('<div class="map-empty svelte-1uha8ag"><strong>No live markers yet</strong> <p class="svelte-1uha8ag">Enable location permission so your marker can appear on the live map.</p></div>'),Hr=N('<button type="button" class="pill svelte-1uha8ag"><span> </span> <span> </span> <small class="svelte-1uha8ag"> </small></button>'),Vr=N('<section class="map-panel card svelte-1uha8ag"><div class="panel-head svelte-1uha8ag"><h3 class="svelte-1uha8ag">Live Convoy Map</h3> <p class="svelte-1uha8ag"> </p></div> <div class="map-canvas svelte-1uha8ag"><div class="map-live svelte-1uha8ag" aria-label="Live map"></div> <!></div> <p class="map-attribution svelte-1uha8ag" role="note" aria-label="Map attribution"><a href="https://leafletjs.com" target="_blank" rel="noopener noreferrer" class="svelte-1uha8ag">Leaflet</a> <span aria-hidden="true">‚Ä¢</span> <span>Map data ¬© <a href="https://www.openstreetmap.org/copyright" target="_blank" rel="noopener noreferrer" class="svelte-1uha8ag">OpenStreetMap contributors</a></span></p> <div class="participant-row svelte-1uha8ag"></div></section>'),$r=N('<div class="empty-state svelte-1uha8ag"><strong>No waypoints loaded</strong> <p class="svelte-1uha8ag">Waypoints from the retreat route will show here automatically.</p></div>'),Ur=N('<article class="timeline-card svelte-1uha8ag"><div></div> <div><p class="eyebrow svelte-1uha8ag"></p> <h4 class="svelte-1uha8ag"> </h4> <p class="svelte-1uha8ag"> </p> <small class="svelte-1uha8ag"> </small></div></article>'),jr=N('<div class="timeline svelte-1uha8ag"></div>'),Br=N('<section class="panel card svelte-1uha8ag"><div class="panel-head svelte-1uha8ag"><h3 class="svelte-1uha8ag">Waypoints & Schedule</h3> <p class="svelte-1uha8ag">Keep everyone aligned on ETAs and checkpoint progress.</p></div> <!></section>'),Jr=N('<div class="empty-state svelte-1uha8ag"><strong>No messages yet</strong> <p class="svelte-1uha8ag">Start with a quick check-in for the group.</p></div>'),zr=N('<article><header class="svelte-1uha8ag"><strong> </strong> <small class="svelte-1uha8ag"> </small></header> <p class="svelte-1uha8ag"> </p></article>'),Yr=N('<small class="subtle svelte-1uha8ag"> </small>'),Wr=N('<section class="panel card svelte-1uha8ag"><div class="panel-head svelte-1uha8ag"><h3 class="svelte-1uha8ag">Group Chat</h3> <p class="svelte-1uha8ag">Use chat for normal updates and prayer mode for care moments.</p></div> <div class="chat-list svelte-1uha8ag"><!></div> <div class="composer svelte-1uha8ag"><div class="mode-toggle svelte-1uha8ag"><button type="button">Chat</button> <button type="button">Prayer Request</button></div> <textarea rows="3" class="svelte-1uha8ag"></textarea> <button type="button" class="svelte-1uha8ag">Send</button> <!></div></section>'),Kr=N('<div class="empty-state svelte-1uha8ag"><strong>Leader access required</strong> <p class="svelte-1uha8ag">You can receive alerts here, but only leaders can broadcast emergency notices.</p></div>'),Qr=N('<button type="button"> </button>'),Gr=N('<div class="alert-builder svelte-1uha8ag"><div class="severity-grid svelte-1uha8ag"></div> <textarea rows="4" placeholder="Describe the urgent issue and what the group should do next." class="svelte-1uha8ag"></textarea> <div class="alert-preview card svelte-1uha8ag"><p class="eyebrow svelte-1uha8ag">Preview</p> <p class="svelte-1uha8ag"><strong> </strong> </p></div> <button type="button" class="danger svelte-1uha8ag">Send emergency alert</button></div>'),Xr=N('<section class="panel card svelte-1uha8ag"><div class="panel-head svelte-1uha8ag"><h3 class="svelte-1uha8ag">Emergency Alert Composer</h3> <p class="svelte-1uha8ag">Leader-only high-signal channel with confirmation safeguard.</p></div> <!></section>'),Zr=N('<img alt="Profile" class="svelte-1uha8ag"/>'),en=N('<div class="avatar-fallback svelte-1uha8ag"> </div>'),an=N('<section class="panel card svelte-1uha8ag"><div class="panel-head svelte-1uha8ag"><h3 class="svelte-1uha8ag">Profile & Vehicle</h3> <p class="svelte-1uha8ag">Keep your details current so others can identify you quickly on the road.</p></div> <article class="profile-card card svelte-1uha8ag"><div class="avatar-wrap svelte-1uha8ag"><!></div> <div class="profile-fields svelte-1uha8ag"><label class="svelte-1uha8ag">Name <input readonly="" class="svelte-1uha8ag"/></label> <label class="svelte-1uha8ag">Vehicle color <input placeholder="e.g. Silver" class="svelte-1uha8ag"/></label> <label class="svelte-1uha8ag">Make/model <input placeholder="e.g. Honda CR-V" class="svelte-1uha8ag"/></label></div></article> <article class="location-sharing card svelte-1uha8ag"><div><p class="eyebrow svelte-1uha8ag">Privacy</p> <h4 class="svelte-1uha8ag"> </h4> <p class="svelte-1uha8ag">Turn this off anytime to remove your marker from the live map. You can still use chat and waypoints.</p></div> <button type="button"><!></button></article> <div class="profile-actions svelte-1uha8ag"><label class="upload-btn svelte-1uha8ag"> <input type="file" accept="image/png,image/jpeg,image/webp" class="svelte-1uha8ag"/></label> <button type="button" class="ghost svelte-1uha8ag">Remove photo</button> <button type="button" class="ghost svelte-1uha8ag">Save vehicle details</button> <button type="button" class="danger-outline svelte-1uha8ag"> </button></div></section>'),tn=N('<main><header class="topbar card svelte-1uha8ag"><div><p class="eyebrow svelte-1uha8ag"> </p> <h2 class="svelte-1uha8ag">Convoy Control</h2> <p class="subtle svelte-1uha8ag"> </p></div> <div class="topbar-actions svelte-1uha8ag"><button type="button" class="ghost svelte-1uha8ag"> </button> <button type="button" class="ghost svelte-1uha8ag"> </button></div></header> <!> <nav class="tabbar card svelte-1uha8ag"></nav> <!></main>'),rn=N('<span class="svelte-1uha8ag"> </span>'),nn=N('<p class="place-label-line svelte-1uha8ag"> <!></p>'),ln=N('<section class="sheet-backdrop svelte-1uha8ag" aria-label="Participant quick actions"><button type="button" class="sheet-hitbox svelte-1uha8ag" aria-label="Close participant quick actions"></button> <article class="participant-sheet card svelte-1uha8ag"><header class="svelte-1uha8ag"><h4 class="svelte-1uha8ag"> </h4> <p class="svelte-1uha8ag"> </p> <!></header> <div class="quick-actions svelte-1uha8ag"><button type="button" class="svelte-1uha8ag">üìû Call</button> <button type="button" class="svelte-1uha8ag">üí¨ Message</button> <button type="button" class="svelte-1uha8ag">üôè Pray</button> <button type="button" class="alert-leader-btn svelte-1uha8ag"><span class="alert-leader-icon svelte-1uha8ag" aria-hidden="true">üö®</span> <span>Alert leader</span></button></div> <small class="subtle svelte-1uha8ag"> </small></article></section>'),sn=N(`<section class="sheet-backdrop svelte-1uha8ag" aria-label="Emergency confirmation"><button type="button" class="sheet-hitbox svelte-1uha8ag" aria-label="Close emergency confirmation"></button> <article class="confirm-modal card svelte-1uha8ag"><h4 class="svelte-1uha8ag">Confirm emergency broadcast</h4> <p class="svelte-1uha8ag">This sends a <strong> </strong> alert to the full retreat group.
        Please confirm this message is accurate.</p> <blockquote class="svelte-1uha8ag"> </blockquote> <div class="confirm-actions svelte-1uha8ag"><button type="button" class="ghost svelte-1uha8ag">Cancel</button> <button type="button" class="danger svelte-1uha8ag">Send now</button></div></article></section>`),on=N('<aside class="toast error svelte-1uha8ag"> </aside>'),cn=N('<aside class="toast success svelte-1uha8ag"> </aside>'),un=N("<!> <!> <!> <!> <!>",1);function mn(t,d){wr(d,!1);const u=b(),o=b(),_=b(),f=b(),h="caravan_device_token",T="caravan_theme_mode";let g=b(!1),m=b(!1),E=b(!1),ce=b(!1),V=b(!1),J=b(!1),$=b("map"),ue=b("chat"),v=b("day"),p=b(!0),Ce=b(""),Te=b(""),ve=b(""),xe=b(""),P=b(""),D=b(null),K=b(null),L=b([]),U=b([]),De=b([]),ye=b([]),ze=b(""),Ye=b(""),Ee=b("high"),sa=b(!1),R=b(null),We=b(""),Ke=b(""),Ze=b(""),ia=b(""),Re=b(""),Ea=null,oa=null,ka=!1,Ta=!1,X=b(!0),ca=b(!1),Ha=0,ea=b(null),Fe=null,ee=b(null),Qe=null,Ne=!1,ua=0;const dt=[{id:"map",label:"Map",icon:"üó∫Ô∏è"},{id:"waypoints",label:"Plan",icon:"üìç"},{id:"chat",label:"Chat",icon:"üí¨"},{id:"alert",label:"Alert",icon:"üö®"},{id:"profile",label:"Profile",icon:"üë§"}];function Va(a){return a.trim().toUpperCase().replace(/[^A-Z0-9]/g,"").slice(0,6)}function $a(a){if(!a)return"TBD";const n=new Date(a);return Number.isNaN(n.getTime())?"TBD":n.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"})}function Pa(a){return a==null?"offline":a<60?"just now":a<3600?`${Math.floor(a/60)}m ago`:`${Math.floor(a/3600)}h ago`}function ft(a){return a==null||!Number.isFinite(a)?"":a<1e3?`${Math.round(a)}m`:`${(a/1e3).toFixed(1)}km`}function Ua(a,n){return a==null||n===null||n===void 0||!Number.isFinite(a)||!Number.isFinite(n)||Math.abs(a)>90||Math.abs(n)>180?!1:!(a===0&&n===0)}function ht(){const a=e(K)?.destination?.lat,n=e(K)?.destination?.lng;return Ua(a,n)?{lat:Number(a),lng:Number(n)}:null}function gt(a){return a.filter(n=>Ua(n.location?.lat,n.location?.lng))}async function pt(){if(!(typeof window>"u")&&!(!e(m)||e($)!=="map")&&e(ea)){if(!Fe){const a=await zt(()=>import("../chunks/CjPBq9Bq.js").then(n=>n.l),[],import.meta.url);Fe=a.default??a}e(ee)||(r(ee,Fe.map(e(ea),{zoomControl:!0,attributionControl:!1})),Fe.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:"&copy; OpenStreetMap contributors"}).addTo(e(ee)),Qe=Fe.layerGroup().addTo(e(ee)),Ne=!1,ua=0),ja(),window.requestAnimationFrame(()=>{e(ee)?.invalidateSize()})}}function ja(){if(!e(ee)||!Qe||!Fe)return;Qe.clearLayers();const a=e(o),n=ht(),c=[];for(const y of a){const A=Number(y.location.lat),ae=Number(y.location.lng),te=y.is_current_user?"#1f9e59":y.is_leader?"#8f0030":"#2458c6",pe=Fe.circleMarker([A,ae],{radius:y.is_current_user?9:7,color:te,weight:y.is_current_user?3:2,fillColor:te,fillOpacity:.9});pe.bindPopup(`<strong>${y.name}</strong><br>${Pa(y.last_seen_seconds_ago)}`),pe.addTo(Qe),c.push([A,ae])}if(n){const y=Fe.circleMarker([n.lat,n.lng],{radius:8,color:"#b36a00",weight:2,fillColor:"#f59e0b",fillOpacity:.85});y.bindPopup(`<strong>Destination</strong><br>${e(K)?.destination?.name??"Retreat destination"}`),y.addTo(Qe),c.push([n.lat,n.lng])}const S=ua===0;if(ua=a.length,!c.length){Ne||(e(ee).setView([35.1495,-90.049],5),Ne=!0);return}if(c.length===1){(!Ne||S)&&(e(ee).setView(c[0],11),Ne=!0);return}(!Ne||S)&&(e(ee).fitBounds(c,{padding:[32,32],maxZoom:12}),Ne=!0)}async function _t(a){if(!e(P)||!e(p)||Ta||!e(X))return;const n=Date.now();if(!(n-Ha<25e3)){Ta=!0;try{const c=a.coords;await he("/location",{method:"POST",body:JSON.stringify({latitude:c.latitude,longitude:c.longitude,accuracy:Number.isFinite(c.accuracy)?c.accuracy:null,speed:c.speed!==null&&Number.isFinite(c.speed)&&c.speed>=0?c.speed:null,heading:c.heading!==null&&Number.isFinite(c.heading)?c.heading:null,altitude:c.altitude!==null&&Number.isFinite(c.altitude)?c.altitude:null,recorded_at:new Date(a.timestamp).toISOString()})},e(P)),Ha=n,r(L,e(L).map(S=>S.is_current_user?{...S,location:{lat:c.latitude,lng:c.longitude,accuracy:Number.isFinite(c.accuracy)?c.accuracy:null,speed:c.speed!==null&&Number.isFinite(c.speed)&&c.speed>=0?c.speed:null,heading:c.heading!==null&&Number.isFinite(c.heading)?c.heading:null,recorded_at:new Date(a.timestamp).toISOString()},last_seen_seconds_ago:0}:S))}catch{}finally{Ta=!1}}}function ya(){typeof navigator>"u"||navigator.geolocation&&oa!==null&&(navigator.geolocation.clearWatch(oa),oa=null)}function mt(){typeof navigator>"u"||navigator.geolocation&&(!e(m)||!e(P)||!e(X)||oa===null&&(oa=navigator.geolocation.watchPosition(a=>{_t(a)},a=>{a.code===a.PERMISSION_DENIED&&!ka&&(we("Location permission is disabled. Enable it to share live map markers."),ka=!0)},{enableHighAccuracy:!0,maximumAge:15e3,timeout:15e3})))}function Pe(a){r(ia,a),setTimeout(()=>{e(ia)===a&&r(ia,"")},2600)}function we(a){r(Ze,a),setTimeout(()=>{e(Ze)===a&&r(Ze,"")},4200)}async function bt(){r(E,!0),r(Ze,"");try{const a=await he("/join",{method:"POST",body:JSON.stringify({code:Va(e(Ce)),name:e(Te).trim(),vehicle_color:e(ve).trim()||null,vehicle_description:e(xe).trim()||null})});r(P,a.data.device_token),localStorage.setItem(h,e(P)),await Ba(e(P)),Pe("Joined convoy successfully.")}catch(a){we(a instanceof Error?a.message:"Unable to join retreat.")}finally{r(E,!1)}}async function Ba(a){{const[n,c,S,y]=await Promise.all([he("/status",{},a),he("/locations",{},a),he("/waypoints",{},a),he("/messages?limit=100",{},a)]);r(D,n.data.participant),r(K,n.data.retreat),r(L,c.data),r(U,[...S.data].sort((ae,te)=>ae.order-te.order)),r(De,y.data);const A=e(L).find(ae=>ae.is_current_user);r(X,A?.location_sharing_enabled??n.data.participant.location_sharing_enabled??!0),A&&(r(We,A.vehicle_color??e(We)),r(Ke,A.vehicle_description??e(Ke))),r(m,!0),Ne=!1,ua=0,r(g,!0)}}async function qe(){if(!(!e(P)||!e(m))){r(ce,!0);try{const[a,n,c]=await Promise.all([he("/locations",{},e(P)),he("/waypoints",{},e(P)),he("/messages?limit=100",{},e(P))]);r(L,a.data),r(U,[...n.data].sort((y,A)=>y.order-A.order)),r(De,c.data);const S=e(L).find(y=>y.is_current_user);S&&(r(X,S.location_sharing_enabled??e(X)),r(We,S.vehicle_color??e(We)),r(Ke,S.vehicle_description??e(Ke)))}catch(a){we(a instanceof Error?a.message:"Unable to refresh retreat data.")}finally{r(ce,!1)}}}function Ja(a,n){r(ye,[...e(ye),{id:`${Date.now()}-${Math.random().toString(16).slice(2,8)}`,content:a,mode:n,createdAt:Date.now()}]),r(Re,`${e(ye).length} message${e(ye).length===1?"":"s"} queued while offline.`)}async function yt(){const a=e(ze).trim();if(a){if(!e(p)){Ja(a,e(ue)),r(ze,"");return}await za(a,e(ue)),r(ze,"")}}async function za(a,n){const c=e(L).find(y=>y.is_current_user),S={content:n==="prayer"?`üôè Prayer Request: ${a}`:a,message_type:"chat",latitude:c?.location?.lat,longitude:c?.location?.lng};try{await he("/messages",{method:"POST",body:JSON.stringify(S)},e(P)),await qe(),Pe(n==="prayer"?"Prayer request sent.":"Message sent.")}catch(y){const A=y instanceof Error?y.message:"Unable to send message.";we(A),Ja(a,n)}}async function Ya(){if(!e(ye).length||!e(p))return;const a=[...e(ye)];r(ye,[]);for(const n of a)await za(n.content,n.mode);r(Re,"Queued messages flushed."),setTimeout(()=>{e(Re)==="Queued messages flushed."&&r(Re,"")},2500)}async function wt(){if(!e(_)){we("Only retreat leaders can send emergency alerts.");return}const a=e(Ye).trim();if(!a){we("Please enter the emergency message before sending.");return}try{await he("/messages",{method:"POST",body:JSON.stringify({message_type:"alert",content:`[${e(Ee).toUpperCase()}] ${a}`})},e(P)),Pe(`Emergency alert sent (${e(Ee)}).`),r(Ye,""),r(sa,!1),r($,"chat"),await qe()}catch(n){we(n instanceof Error?n.message:"Unable to send emergency alert.")}}function St(a){r(R,a)}function Ct(){r(R,null)}function xt(a){r($,"chat"),r(ue,"chat"),r(ze,`@${a.name} `),r(R,null)}function Et(a){r($,"chat"),r(ue,"prayer"),r(ze,`Praying for ${a.name} ‚Äî `),r(R,null)}function kt(a){r($,"alert"),r(Ee,"high"),r(Ye,`Need leader support near ${a.name}: `),r(R,null)}function Tt(a){Pe("Call shortcut wired. Number binding comes next.")}async function Pt(a){if(a&&e(P)){r(J,!0);try{const n=await Ot(a);await he("/profile-photo",{method:"POST",body:JSON.stringify({avatar_base64:n})},e(P)),Pe("Profile photo updated."),await qe()}catch(n){we(n instanceof Error?n.message:"Could not upload profile photo.")}finally{r(J,!1)}}}async function Dt(){if(e(P)){r(J,!0);try{await he("/profile-photo",{method:"DELETE"},e(P)),Pe("Profile photo removed."),await qe()}catch(a){we(a instanceof Error?a.message:"Could not remove profile photo.")}finally{r(J,!1)}}}async function Nt(a){if(e(P)&&!e(ca)&&a!==e(X)){r(ca,!0);try{const n=await he("/location-sharing",{method:"POST",body:JSON.stringify({enabled:a})},e(P));r(X,n.data.location_sharing_enabled),e(D)&&r(D,{...e(D),location_sharing_enabled:e(X)}),r(L,e(L).map(c=>c.is_current_user?{...c,location_sharing_enabled:e(X),location:e(X)?c.location:null}:c)),e(X)?(ka=!1,Pe("Location sharing re-enabled.")):(ya(),Pe("Location sharing paused. Your marker is hidden from the map.")),await qe()}catch(n){we(n instanceof Error?n.message:"Could not update location sharing.")}finally{r(ca,!1)}}}async function Mt(){if(e(P)){r(V,!0);try{await he("/leave",{method:"POST"},e(P)),localStorage.removeItem(h),r(m,!1),r(P,""),r(D,null),r(K,null),r(L,[]),r(U,[]),r(De,[]),r(ye,[]),r(X,!0),ya(),e(ee)&&(e(ee).remove(),r(ee,null),Qe=null),Ne=!1,ua=0,Pe("You have left the retreat.")}catch(a){we(a instanceof Error?a.message:"Could not leave retreat.")}finally{r(V,!1)}}}async function At(){if(!e(p)){we("Still offline. Messages remain queued.");return}await Ya()}function Ot(a){return new Promise((n,c)=>{const S=new FileReader;S.onload=()=>n(String(S.result)),S.onerror=()=>c(new Error("Failed to read file")),S.readAsDataURL(a)})}function Lt(){const a=new Date().toISOString(),n=Date.now();r(D,{id:101,name:"Chris Hogg",is_leader:!0,location_sharing_enabled:!0,avatar_url:null}),r(K,{id:501,name:"Spring Retreat Convoy",destination:{name:"Branson Camp Grounds",lat:36.6406,lng:-93.2185},starts_at:new Date(n-3600*1e3).toISOString(),ends_at:new Date(n+1080*60*1e3).toISOString(),participant_count:4}),r(L,[{participant_id:101,name:"Chris Hogg",gender:null,avatar_url:null,vehicle_color:"Silver",vehicle_description:"Ford F-150",is_leader:!0,is_current_user:!0,location_sharing_enabled:!0,location:{lat:36.612,lng:-93.287,accuracy:9,speed:17,heading:112,recorded_at:a,place:{label:"At Trumann Community Health Club",name:"Trumann Community Health Club",relation:"at",distance_m:12,confidence:"high",source:"nominatim"}},last_seen_seconds_ago:5},{participant_id:102,name:"Sarah Jenkins",gender:null,avatar_url:null,vehicle_color:"White",vehicle_description:"Honda CR-V",is_leader:!1,is_current_user:!1,location_sharing_enabled:!0,location:{lat:36.618,lng:-93.272,accuracy:13,speed:18,heading:108,recorded_at:a},last_seen_seconds_ago:28},{participant_id:103,name:"Micah Davis",gender:null,avatar_url:null,vehicle_color:"Blue",vehicle_description:"Chevy Traverse",is_leader:!1,is_current_user:!1,location_sharing_enabled:!0,location:{lat:36.604,lng:-93.248,accuracy:11,speed:21,heading:96,recorded_at:a},last_seen_seconds_ago:13},{participant_id:104,name:"Linda Perez",gender:null,avatar_url:null,vehicle_color:"Black",vehicle_description:"Kia Telluride",is_leader:!1,is_current_user:!1,location_sharing_enabled:!0,location:{lat:36.597,lng:-93.214,accuracy:14,speed:16,heading:92,recorded_at:a},last_seen_seconds_ago:36}]),r(U,[{id:1,name:"Fuel + regroup",description:"Top off and verify all vans are accounted for.",lat:36.621,lng:-93.295,order:1,eta:new Date(n+1500*1e3).toISOString()},{id:2,name:"Prayer circle",description:"10-minute devotion and route update.",lat:36.634,lng:-93.252,order:2,eta:new Date(n+3300*1e3).toISOString()},{id:3,name:"Arrive at retreat camp",description:"Unload and check in by group name.",lat:36.641,lng:-93.219,order:3,eta:new Date(n+5400*1e3).toISOString()}]),r(De,[{id:1,message_type:"chat",content:"All vehicles are rolling. Next checkpoint in ~25 minutes.",sender:{id:101,name:"Chris Hogg",is_leader:!0,gender:null,avatar_url:null},location:null,created_at:new Date(n-480*1e3).toISOString()},{id:2,message_type:"chat",content:"üôè Prayer Request: please pray for safe travel and calm weather.",sender:{id:102,name:"Sarah Jenkins",is_leader:!1,gender:null,avatar_url:null},location:null,created_at:new Date(n-240*1e3).toISOString()},{id:3,message_type:"alert",content:"[HIGH] Keep hazard lights on for reduced visibility zone ahead.",sender:{id:101,name:"Chris Hogg",is_leader:!0,gender:null,avatar_url:null},location:null,created_at:new Date(n-120*1e3).toISOString()}]),r(We,"Silver"),r(Ke,"Ford F-150"),r(m,!0),r(g,!0),r(Re,"Demo mode active from ?demo=1 for visual sharing.")}Qt(()=>{r(p,navigator.onLine);const a=localStorage.getItem(T);(a==="day"||a==="night")&&r(v,a),(async()=>{if(new URLSearchParams(window.location.search).get("demo")==="1"){Lt();return}const A=localStorage.getItem(h);if(A){r(P,A);try{await Ba(A)}catch{localStorage.removeItem(h),r(P,""),r(g,!0)}}else r(g,!0)})();const n=async()=>{r(p,!0),await Ya(),await qe()},c=()=>{r(p,!1),r(Re,"You are offline. New messages will be queued.")};return window.addEventListener("online",n),window.addEventListener("offline",c),Ea=setInterval(()=>{e(m)&&e(p)&&qe()},2e4),()=>{window.removeEventListener("online",n),window.removeEventListener("offline",c),Ea&&clearInterval(Ea),ya(),e(ee)&&(e(ee).remove(),r(ee,null),Qe=null)}}),Ue(()=>e(L),()=>{r(u,e(L).filter(a=>(a.last_seen_seconds_ago??9999)<300).length)}),Ue(()=>e(L),()=>{r(o,gt(e(L)))}),Ue(()=>e(D),()=>{r(_,e(D)?.is_leader===!0)}),Ue(()=>e(ye),()=>{r(f,e(ye).length)}),Ue(()=>e(v),()=>{e(v)==="night"&&typeof document<"u"?document.body.classList.add("theme-night"):typeof document<"u"&&document.body.classList.remove("theme-night")}),Ue(()=>(e(m),e($),e(ea)),()=>{e(m)&&e($)==="map"&&e(ea)&&pt()}),Ue(()=>(e(ee),e(m),e($)),()=>{e(ee)&&e(m)&&e($)==="map"&&ja()}),Ue(()=>(e(m),e(P),e(X)),()=>{e(m)&&e(P)&&e(X)?mt():ya()}),Sr(),Kt();var Wa=un(),Ka=tt(Wa);{var It=a=>{var n=Lr();C(a,n)},Rt=a=>{var n=Ir(),c=s(n),S=i(s(c),2),y=s(S),A=i(s(y));Xe(A),l(y);var ae=i(y,2),te=i(s(ae));Xe(te),l(ae);var pe=i(ae,2),_e=s(pe),Me=i(s(_e));Xe(Me),l(_e);var me=i(_e,2),Ae=i(s(me));Xe(Ae),l(me),l(pe);var ke=i(pe,2),aa=s(ke,!0);l(ke),l(S);var He=i(S,2),Ve=s(He),va=s(Ve,!0);l(Ve),l(He),l(c),l(n),W(()=>{ke.disabled=e(E),w(aa,e(E)?"Joining‚Ä¶":"Start the Journey"),w(va,e(v)==="day"?"üåô Night mode":"‚òÄÔ∏è Day mode")}),Je(A,()=>e(Ce),re=>r(Ce,re)),q("input",A,re=>{const Ge=re.currentTarget;r(Ce,Va(Ge.value))}),Je(te,()=>e(Te),re=>r(Te,re)),Je(Me,()=>e(ve),re=>r(ve,re)),Je(Ae,()=>e(xe),re=>r(xe,re)),q("submit",S,Mr(bt)),q("click",Ve,()=>{r(v,e(v)==="day"?"night":"day"),localStorage.setItem(T,e(v))}),C(a,n)},Ft=a=>{var n=tn(),c=s(n),S=s(c),y=s(S),A=s(y,!0);l(y);var ae=i(y,4),te=s(ae);l(ae),l(S);var pe=i(S,2),_e=s(pe),Me=s(_e,!0);l(_e);var me=i(_e,2),Ae=s(me,!0);l(me),l(pe),l(c);var ke=i(c,2);{var aa=z=>{var k=Rr(),M=s(k),Q=s(M),ne=s(Q,!0);l(Q);var F=i(Q,2),j=s(F);{var Z=O=>{var I=ga();W(()=>w(I,`${e(f)??""} queued message${e(f)===1?"":"s"} waiting to send.`)),C(O,I)},B=O=>{var I=ga("You can keep using the app ‚Äî new messages will sync when your signal returns.");C(O,I)};oe(j,O=>{e(p)?O(Z):O(B,!1)})}l(F),l(M);var de=i(M,2);l(k),W(()=>w(ne,e(p)?"Queued updates ready":"Offline mode active")),q("click",de,At),C(z,k)};oe(ke,z=>{(!e(p)||e(f)>0)&&z(aa)})}var He=i(ke,2);_a(He,5,()=>dt,pa,(z,k)=>{var M=Fr();let Q;var ne=s(M),F=s(ne,!0);l(ne);var j=i(ne,2),Z=s(j,!0);l(j),l(M),W(()=>{Q=Be(M,1,"svelte-1uha8ag",null,Q,{active:e($)===e(k).id}),w(F,(e(k),x(()=>e(k).icon))),w(Z,(e(k),x(()=>e(k).label)))}),q("click",M,()=>r($,e(k).id)),C(z,M)}),l(He);var Ve=i(He,2);{var va=z=>{var k=Vr(),M=s(k),Q=i(s(M),2),ne=s(Q,!0);l(Q),l(M);var F=i(M,2),j=s(F);Yt(j,O=>r(ea,O),()=>e(ea));var Z=i(j,2);{var B=O=>{var I=qr();C(O,I)};oe(Z,O=>{e(o),x(()=>e(o).length===0)&&O(B)})}l(F);var de=i(F,4);_a(de,5,()=>e(L),pa,(O,I)=>{var le=Hr(),ge=s(le),be=s(ge,!0);l(ge);var se=i(ge,2),H=s(se,!0);l(se);var G=i(se,2),ie=s(G,!0);l(G),l(le),W(Oe=>{w(be,(e(I),x(()=>e(I).is_leader?"‚≠ê":"üë§"))),w(H,(e(I),x(()=>e(I).name))),w(ie,Oe)},[()=>(e(I),x(()=>Pa(e(I).last_seen_seconds_ago)))]),q("click",le,()=>St(e(I))),C(O,le)}),l(de),l(k),W(()=>w(ne,(e(K),x(()=>e(K)?.destination?.name?`Destination: ${e(K).destination.name}`:"Destination syncing‚Ä¶")))),C(z,k)},re=z=>{var k=Br(),M=i(s(k),2);{var Q=F=>{var j=$r();C(F,j)},ne=F=>{var j=jr();_a(j,5,()=>e(U),pa,(Z,B,de)=>{var O=Ur(),I=s(O),le=i(I,2),ge=s(le);ge.textContent=`Stop ${de+1}`;var be=i(ge,2),se=s(be,!0);l(be);var H=i(be,2),G=s(H,!0);l(H);var ie=i(H,2),Oe=s(ie);l(ie),l(le),l(O),W((Se,$e)=>{Be(I,1,`timeline-dot ${Se??""}`,"svelte-1uha8ag"),w(se,(e(B),x(()=>e(B).name))),w(G,(e(B),x(()=>e(B).description??"No additional note."))),w(Oe,`ETA ${$e??""}`)},[()=>(e(B),x(()=>new Date(e(B).eta??"").getTime()<Date.now()?"done":"")),()=>(e(B),x(()=>$a(e(B).eta)))]),C(Z,O)}),l(j),C(F,j)};oe(M,F=>{e(U),x(()=>e(U).length===0)?F(Q):F(ne,!1)})}l(k),C(z,k)},Ge=z=>{var k=Wr(),M=i(s(k),2),Q=s(M);{var ne=H=>{var G=Jr();C(H,G)},F=H=>{var G=Wt(),ie=tt(G);_a(ie,1,()=>e(De),pa,(Oe,Se)=>{var $e=zr(),da=s($e),ta=s(da),fa=s(ta,!0);l(ta);var ha=i(ta,2),Sa=s(ha,!0);l(ha),l(da);var ra=i(da,2),Ca=s(ra,!0);l(ra),l($e),W(na=>{Be($e,1,(e(Se),x(()=>`chat-item ${e(Se).message_type==="alert"?"alert":""}`)),"svelte-1uha8ag"),w(fa,(e(Se),x(()=>e(Se).sender.name))),w(Sa,na),w(Ca,(e(Se),x(()=>e(Se).content)))},[()=>(e(Se),x(()=>$a(e(Se).created_at)))]),C(Oe,$e)}),C(H,G)};oe(Q,H=>{e(De),x(()=>e(De).length===0)?H(ne):H(F,!1)})}l(M);var j=i(M,2),Z=s(j),B=s(Z);let de;var O=i(B,2);let I;l(Z);var le=i(Z,2);nt(le);var ge=i(le,2),be=i(ge,2);{var se=H=>{var G=Yr(),ie=s(G,!0);l(G),W(()=>w(ie,e(Re))),C(H,G)};oe(be,H=>{e(Re)&&H(se)})}l(j),l(k),W(()=>{de=Be(B,1,"svelte-1uha8ag",null,de,{active:e(ue)==="chat"}),I=Be(O,1,"svelte-1uha8ag",null,I,{active:e(ue)==="prayer"}),lt(le,"placeholder",e(ue)==="prayer"?"Share a prayer need for the caravan‚Ä¶":"Send a convoy update‚Ä¶")}),q("click",B,()=>r(ue,"chat")),q("click",O,()=>r(ue,"prayer")),Je(le,()=>e(ze),H=>r(ze,H)),q("click",ge,yt),C(z,k)},wa=z=>{var k=Xr(),M=i(s(k),2);{var Q=F=>{var j=Kr();C(F,j)},ne=F=>{var j=Gr(),Z=s(j);_a(Z,4,()=>["low","medium","high","critical"],pa,(se,H)=>{var G=Qr();let ie;var Oe=s(G,!0);l(G),W(()=>{ie=Be(G,1,"svelte-1uha8ag",null,ie,{active:e(Ee)===H}),w(Oe,H)}),q("click",G,()=>r(Ee,H)),C(se,G)}),l(Z);var B=i(Z,2);nt(B);var de=i(B,2),O=i(s(de),2),I=s(O),le=s(I);l(I);var ge=i(I);l(O),l(de);var be=i(de,2);l(j),W(se=>{w(le,`[${se??""}]`),w(ge,` ${(e(Ye)||"No message yet.")??""}`)},[()=>(e(Ee),x(()=>e(Ee).toUpperCase()))]),Je(B,()=>e(Ye),se=>r(Ye,se)),q("click",be,()=>r(sa,!0)),C(F,j)};oe(M,F=>{e(_)?F(ne,!1):F(Q)})}l(k),C(z,k)},Da=z=>{var k=an(),M=i(s(k),2),Q=s(M),ne=s(Q);{var F=Y=>{var fe=Zr();W(()=>lt(fe,"src",(e(D),x(()=>e(D).avatar_url)))),C(Y,fe)},j=Y=>{var fe=en(),Bt=s(fe,!0);l(fe),W(Jt=>w(Bt,Jt),[()=>(e(D),x(()=>e(D)?.name?.slice(0,1)??"C"))]),C(Y,fe)};oe(ne,Y=>{e(D),x(()=>e(D)?.avatar_url)?Y(F):Y(j,!1)})}l(Q);var Z=i(Q,2),B=s(Z),de=i(s(B));Xe(de),l(B);var O=i(B,2),I=i(s(O));Xe(I),l(O);var le=i(O,2),ge=i(s(le));Xe(ge),l(le),l(Z),l(M);var be=i(M,2),se=s(be),H=i(s(se),2),G=s(H);l(H),rt(2),l(se);var ie=i(se,2),Oe=s(ie);{var Se=Y=>{var fe=ga("Saving‚Ä¶");C(Y,fe)},$e=Y=>{var fe=ga("Unshare my location");C(Y,fe)},da=Y=>{var fe=ga("Share my location again");C(Y,fe)};oe(Oe,Y=>{e(ca)?Y(Se):e(X)?Y($e,1):Y(da,!1)})}l(ie),l(be);var ta=i(be,2),fa=s(ta),ha=s(fa),Sa=i(ha);l(fa);var ra=i(fa,2),Ca=i(ra,2),na=i(Ca,2),jt=s(na,!0);l(na),l(ta),l(k),W(()=>{xr(de,(e(D),x(()=>e(D)?.name??""))),w(G,`Location sharing is ${e(X)?"On":"Off"}`),Be(ie,1,Dr(e(X)?"danger-outline":"ghost"),"svelte-1uha8ag"),ie.disabled=e(ca),w(ha,`${e(J)?"Uploading‚Ä¶":"Upload profile photo"} `),Sa.disabled=e(J),ra.disabled=e(J),na.disabled=e(V),w(jt,e(V)?"Leaving‚Ä¶":"Leave retreat")}),Je(I,()=>e(We),Y=>r(We,Y)),Je(ge,()=>e(Ke),Y=>r(Ke,Y)),q("click",ie,()=>Nt(!e(X))),q("change",Sa,Y=>{const fe=Y.currentTarget;Pt(fe.files?.[0]??null),fe.value=""}),q("click",ra,Dt),q("click",Ca,()=>Pe("Vehicle detail save endpoint is next backend step.")),q("click",na,Mt),C(z,k)};oe(Ve,z=>{e($)==="map"?z(va):e($)==="waypoints"?z(re,1):e($)==="chat"?z(Ge,2):e($)==="alert"?z(wa,3):e($)==="profile"&&z(Da,4)})}l(n),W(()=>{Be(n,1,`app-shell ${e(v)==="night"?"night":""}`,"svelte-1uha8ag"),w(A,(e(K),x(()=>e(K)?.name??"Calvary Caravan"))),w(te,`${e(u)??""}/${e(L),x(()=>e(L).length)??""} online ¬∑ ${e(K),e(L),x(()=>e(K)?.participant_count??e(L).length)??""} total`),w(Me,e(v)==="day"?"üåô":"‚òÄÔ∏è"),me.disabled=e(ce),w(Ae,e(ce)?"‚Ä¶":"‚Üª")}),q("click",_e,()=>{r(v,e(v)==="day"?"night":"day"),localStorage.setItem(T,e(v))}),q("click",me,qe),C(a,n)};oe(Ka,a=>{e(g)?e(m)?a(Ft,!1):a(Rt,1):a(It)})}var Qa=i(Ka,2);{var qt=a=>{var n=ln(),c=s(n),S=i(c,2),y=s(S),A=s(y),ae=s(A,!0);l(A);var te=i(A,2),pe=s(te);l(te);var _e=i(te,2);{var Me=re=>{var Ge=nn(),wa=s(Ge),Da=i(wa);{var z=k=>{var M=rn(),Q=s(M);l(M),W(ne=>w(Q,`(${ne??""})`),[()=>(e(R),x(()=>ft(e(R).location.place.distance_m)))]),C(k,M)};oe(Da,k=>{e(R),x(()=>e(R).location.place.distance_m!==null)&&k(z)})}l(Ge),W(()=>w(wa,`üìç ${e(R),x(()=>e(R).location.place.label)??""} `)),C(re,Ge)};oe(_e,re=>{e(R),x(()=>e(R).location?.place?.label)&&re(Me)})}l(y);var me=i(y,2),Ae=s(me),ke=i(Ae,2),aa=i(ke,2),He=i(aa,2);l(me);var Ve=i(me,2),va=s(Ve);l(Ve),l(S),l(n),W(re=>{w(ae,(e(R),x(()=>e(R).name))),w(pe,`${e(R),x(()=>e(R).vehicle_color??"Vehicle TBD")??""} ¬∑ ${e(R),x(()=>e(R).vehicle_description??"Description TBD")??""}`),w(va,`Last seen: ${re??""}`)},[()=>(e(R),x(()=>Pa(e(R).last_seen_seconds_ago)))]),q("click",c,Ct),q("click",Ae,()=>Tt(e(R))),q("click",ke,()=>xt(e(R))),q("click",aa,()=>Et(e(R))),q("click",He,()=>kt(e(R))),C(a,n)};oe(Qa,a=>{e(R)&&a(qt)})}var Ga=i(Qa,2);{var Ht=a=>{var n=sn(),c=s(n),S=i(c,2),y=i(s(S),2),A=i(s(y)),ae=s(A,!0);l(A),rt(),l(y);var te=i(y,2),pe=s(te);l(te);var _e=i(te,2),Me=s(_e),me=i(Me,2);l(_e),l(S),l(n),W((Ae,ke)=>{w(ae,Ae),w(pe,`[${ke??""}] ${(e(Ye)||"No message entered.")??""}`)},[()=>(e(Ee),x(()=>e(Ee).toUpperCase())),()=>(e(Ee),x(()=>e(Ee).toUpperCase()))]),q("click",c,()=>r(sa,!1)),q("click",Me,()=>r(sa,!1)),q("click",me,wt),C(a,n)};oe(Ga,a=>{e(sa)&&a(Ht)})}var Xa=i(Ga,2);{var Vt=a=>{var n=on(),c=s(n);l(n),W(()=>w(c,`‚ö†Ô∏è ${e(Ze)??""}`)),C(a,n)};oe(Xa,a=>{e(Ze)&&a(Vt)})}var $t=i(Xa,2);{var Ut=a=>{var n=cn(),c=s(n);l(n),W(()=>w(c,`‚úÖ ${e(ia)??""}`)),C(a,n)};oe($t,a=>{e(ia)&&a(Ut)})}C(t,Wa),Cr()}export{mn as component};
